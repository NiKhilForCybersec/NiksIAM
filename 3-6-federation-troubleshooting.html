<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Federation Troubleshooting - Ultimate IAM Security Guide</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <div class="page-wrapper">
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" aria-label="Toggle navigation">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    <nav class="sidebar">
      <div class="sidebar-header">
        <a href="index.html" class="sidebar-logo">
          <div class="sidebar-logo-icon">ğŸ”</div>
          <div class="sidebar-logo-text">IAM <span>Guide</span></div>
        </a>
      </div>
      <!-- Navigation generated by JavaScript -->
    </nav>
    <main class="main-content">
      <div class="content-wrapper">
        <article class="content-main">
          <div class="badge badge-l2">L2 Technical</div>
          <h1>Federation Troubleshooting</h1>
          
          <div class="overview-box">
            <h3>ğŸ¯ What This Page Covers</h3>
            <p>SSO and federation issues are among the most common tickets security engineers handle. This covers systematic troubleshooting approaches for SAML, OIDC, and common federation problems.</p>
          </div>

          <h2 id="troubleshooting-flow">Troubleshooting Methodology</h2>
          <div class="flow-diagram"><pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FEDERATION TROUBLESHOOTING FLOW                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                          â”‚
â”‚   1. IDENTIFY                2. CAPTURE               3. ANALYZE              4. FIX   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ â€¢ What app? â”‚           â”‚ â€¢ SAML      â”‚          â”‚ â€¢ Compare   â”‚       â”‚ â€¢ Applyâ”‚ â”‚
â”‚   â”‚ â€¢ What user?â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Tracer    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   expected  â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚   fix  â”‚ â”‚
â”‚   â”‚ â€¢ Error msg?â”‚           â”‚ â€¢ Browser   â”‚          â”‚   vs actual â”‚       â”‚ â€¢ Test â”‚ â”‚
â”‚   â”‚ â€¢ When?     â”‚           â”‚   DevTools  â”‚          â”‚ â€¢ Check     â”‚       â”‚ â€¢ Doc  â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ â€¢ IdP logs  â”‚          â”‚   each fieldâ”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre></div>

          <h2 id="common-errors">Common Errors & Solutions</h2>
          <div class="table-wrapper"><table>
            <thead><tr><th>Error</th><th>Cause</th><th>Solution</th></tr></thead>
            <tbody>
              <tr><td><strong>Invalid Signature</strong></td><td>Certificate mismatch or rotation</td><td>Re-download IdP metadata, update SP with new cert</td></tr>
              <tr><td><strong>Audience Mismatch</strong></td><td>Entity ID doesn't match</td><td>Verify Entity ID in IdP matches SP exactly</td></tr>
              <tr><td><strong>Response Not Valid</strong></td><td>Time skew > 5 minutes</td><td>Sync NTP on both IdP and SP servers</td></tr>
              <tr><td><strong>User Not Found</strong></td><td>NameID doesn't match SP user</td><td>Check NameID format and value mapping</td></tr>
              <tr><td><strong>Missing Attribute</strong></td><td>Required claim not released</td><td>Configure attribute release in IdP</td></tr>
              <tr><td><strong>ACS URL Error</strong></td><td>Redirect URL incorrect</td><td>Update ACS URL in IdP configuration</td></tr>
              <tr><td><strong>Logout Failed</strong></td><td>SLO not configured</td><td>Configure Single Logout URLs on both sides</td></tr>
            </tbody>
          </table></div>

          <h2 id="tools">Troubleshooting Tools</h2>
          <div class="code-block"><div class="code-header"><span class="code-language">Essential Tools</span></div><pre><code># BROWSER TOOLS
1. SAML-tracer (Firefox/Chrome extension)
   - Captures SAML requests and responses
   - Decodes Base64 automatically
   - Shows all HTTP redirects

2. Browser DevTools (Network tab)
   - Filter by "saml" or "oidc"
   - Check response codes
   - View headers and payloads

# COMMAND LINE
# Decode Base64 SAML Response
echo "PHNhbWxwOlJlc..." | base64 -d | xmllint --format -

# Check certificate dates
openssl x509 -in idp-cert.pem -text -noout | grep -A2 "Validity"

# Verify certificate signature
openssl x509 -in idp-cert.pem -fingerprint -noout

# IDP LOGS
Okta: System Log â†’ filter by user, app, event type
Entra: Sign-in logs â†’ filter by application, error code
ADFS: Event Viewer â†’ AD FS â†’ Admin</code></pre></div>

          <h2 id="saml-checklist">SAML Troubleshooting Checklist</h2>
          <div class="code-block"><div class="code-header"><span class="code-language">Step-by-Step Verification</span></div><pre><code># 1. CAPTURE THE SAML RESPONSE
Use SAML-tracer to capture the response during failed login

# 2. CHECK SIGNATURE
â–¡ Is signature valid?
â–¡ Is certificate current (not expired)?
â–¡ Does SP have correct IdP certificate?

# 3. CHECK ISSUER
â–¡ Does <Issuer> match expected IdP Entity ID?
â–¡ Is issuer URL exact match (http vs https, trailing slash)?

# 4. CHECK AUDIENCE
â–¡ Does <Audience> match SP Entity ID exactly?
â–¡ Common issue: trailing slash mismatch

# 5. CHECK TIME CONDITIONS
â–¡ NotBefore - is current time after this?
â–¡ NotOnOrAfter - is current time before this?
â–¡ Server time synced with NTP?

# 6. CHECK ACS URL
â–¡ Does Destination match SP's ACS URL?
â–¡ Is ACS URL configured in IdP?

# 7. CHECK NAMEID
â–¡ Is NameID present?
â–¡ Is format correct (email, persistent, transient)?
â–¡ Does value match what SP expects?

# 8. CHECK ATTRIBUTES
â–¡ Are required attributes present?
â–¡ Are attribute names correct (sometimes case-sensitive)?
â–¡ Are values in expected format?</code></pre></div>

          <h2 id="day-to-day">ğŸ”§ Security Engineer Day-to-Day Tasks</h2>
          <div class="callout tip"><div class="callout-content"><div class="callout-title">ğŸ‘¨â€ğŸ’» What You Actually Do</div>
            
            <p><strong>Common Tickets You Handle:</strong></p>
            <ul>
              <li><strong>"I can't log into Salesforce"</strong> â†’ Check SAML config, capture trace, identify mismatch</li>
              <li><strong>"SSO suddenly stopped working"</strong> â†’ Certificate expired! Rotate and update</li>
              <li><strong>"New user can't access app"</strong> â†’ User not assigned to app, or missing attribute</li>
              <li><strong>"Getting infinite redirect loop"</strong> â†’ ACS URL mismatch or cookie issue</li>
            </ul>

            <p><strong>Proactive Work:</strong></p>
            <ul>
              <li>Monitor certificate expiration dates (set alerts 30 days out)</li>
              <li>Test SSO after IdP upgrades or changes</li>
              <li>Document all federation configurations</li>
              <li>Maintain runbooks for common issues</li>
            </ul>

            <p><strong>When to Escalate:</strong></p>
            <ul>
              <li>IdP-side issues (contact Okta/Microsoft support)</li>
              <li>SP-side issues in vendor app (contact app vendor)</li>
              <li>Widespread outage affecting many users</li>
            </ul>
          </div></div>

          <h2 id="certificate-rotation">Certificate Rotation Procedure</h2>
          <div class="code-block"><div class="code-header"><span class="code-language">Safe Certificate Rotation</span></div><pre><code># PROBLEM: IdP signing certificate expires in 7 days
# SOLUTION: Staged rotation

DAY 1: ADD NEW CERTIFICATE
1. Generate new certificate in IdP
2. Add new cert to SP (keep old cert active)
3. SP now accepts tokens signed with either cert

DAY 2-5: MONITOR
1. Verify SSO still works
2. Check logs for any issues

DAY 6: SWITCH PRIMARY
1. Make new cert primary in IdP
2. All new tokens signed with new cert
3. Keep old cert as backup

DAY 7+: REMOVE OLD
1. After confirming everything works
2. Remove old certificate from SP
3. Remove old certificate from IdP
4. Document change</code></pre></div>

          <h2 id="interview-tips">Interview Tips</h2>
          <div class="callout interview"><div class="callout-content"><div class="callout-title">ğŸ’¡ Key Interview Points</div>
            <ul>
              <li><strong>Tools:</strong> SAML-tracer is essential, learn to read SAML XML</li>
              <li><strong>Common issues:</strong> Certificate expiry, Entity ID mismatch, time skew</li>
              <li><strong>Methodology:</strong> Capture â†’ Decode â†’ Compare expected vs actual</li>
              <li><strong>Certificate rotation:</strong> Add new first, then switch, then remove old</li>
              <li><strong>Logs:</strong> Know where to find logs in Okta, Entra, and ADFS</li>
            </ul>
          </div></div>

          <nav class="page-nav">
            <a href="3-5-b2b-b2c-federation.html" class="page-nav-link prev"><span class="page-nav-label">â† Previous</span><span class="page-nav-title">B2B & B2C Federation</span></a>
            <a href="4-1-entra-overview.html" class="page-nav-link next"><span class="page-nav-label">Next â†’</span><span class="page-nav-title">Entra ID Overview</span></a>
          </nav>
        </article>
      </div>
    </main>
  </div>
  <script src="main.js"></script>
</body>
</html>
