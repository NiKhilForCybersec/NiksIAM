<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NTLM - Ultimate IAM Security Guide</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <div class="page-wrapper">
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" aria-label="Toggle navigation">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    <nav class="sidebar">
      <div class="sidebar-header">
        <a href="index.html" class="sidebar-logo">
          <div class="sidebar-logo-icon">ğŸ”</div>
          <div class="sidebar-logo-text">IAM <span>Guide</span></div>
        </a>
      </div>
    </nav>
    <main class="main-content">
      <div class="content-wrapper">
        <article class="content-main">
          <div class="badge badge-l2">L2 Technical</div>
          <h1>NTLM Authentication</h1>
          
          <div class="overview-box">
            <h3>ğŸ¯ What This Page Covers</h3>
            <p>NTLM is a legacy Windows authentication protocol that should be disabled when possible. This covers how NTLM works, its security weaknesses, and how attackers exploit it.</p>
          </div>

          <div class="callout warning">
            <div class="callout-content">
              <div class="callout-title">âš ï¸ NTLM is Deprecated</div>
              <p>Microsoft recommends disabling NTLM and using Kerberos instead. NTLM has known vulnerabilities and is targeted by attackers. However, many legacy systems still require it.</p>
            </div>
          </div>

          <h2 id="how-ntlm-works">How NTLM Works</h2>

          <div class="flow-diagram">
            <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NTLM CHALLENGE-RESPONSE                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                          â”‚
â”‚   CLIENT                           SERVER                      DOMAIN CONTROLLER        â”‚
â”‚     â”‚                                â”‚                               â”‚                  â”‚
â”‚     â”‚ 1. NEGOTIATE                   â”‚                               â”‚                  â”‚
â”‚     â”‚   "I want to authenticate"     â”‚                               â”‚                  â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                               â”‚                  â”‚
â”‚     â”‚                                â”‚                               â”‚                  â”‚
â”‚     â”‚ 2. CHALLENGE                   â”‚                               â”‚                  â”‚
â”‚     â”‚   8-byte random nonce          â”‚                               â”‚                  â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                               â”‚                  â”‚
â”‚     â”‚                                â”‚                               â”‚                  â”‚
â”‚     â”‚ 3. RESPONSE                    â”‚                               â”‚                  â”‚
â”‚     â”‚   Hash(password + challenge)   â”‚                               â”‚                  â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                               â”‚                  â”‚
â”‚     â”‚                                â”‚                               â”‚                  â”‚
â”‚     â”‚                                â”‚ 4. Verify with DC             â”‚                  â”‚
â”‚     â”‚                                â”‚   (if domain-joined)          â”‚                  â”‚
â”‚     â”‚                                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                  â”‚
â”‚     â”‚                                â”‚                               â”‚                  â”‚
â”‚     â”‚                                â”‚ 5. Validation result          â”‚                  â”‚
â”‚     â”‚                                â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                  â”‚
â”‚     â”‚                                â”‚                               â”‚                  â”‚
â”‚     â”‚ 6. AUTH SUCCESS/FAIL           â”‚                               â”‚                  â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                               â”‚                  â”‚
â”‚                                                                                          â”‚
â”‚   KEY WEAKNESS: Password hash is the credential (not the password itself)              â”‚
â”‚                 If you have the hash, you can authenticate                             â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </pre>
          </div>

          <h2 id="ntlm-attacks">NTLM Attacks</h2>

          <div class="table-wrapper">
            <table>
              <thead><tr><th>Attack</th><th>Description</th><th>Impact</th></tr></thead>
              <tbody>
                <tr>
                  <td><strong>Pass-the-Hash (PtH)</strong></td>
                  <td>Use stolen NTLM hash to authenticate without knowing password</td>
                  <td>Complete account compromise</td>
                </tr>
                <tr>
                  <td><strong>NTLM Relay</strong></td>
                  <td>Relay authentication to another server mid-flow</td>
                  <td>Access to other systems</td>
                </tr>
                <tr>
                  <td><strong>Hash Cracking</strong></td>
                  <td>NTLM hashes are fast to crack (no salt)</td>
                  <td>Password recovery</td>
                </tr>
                <tr>
                  <td><strong>Credential Theft</strong></td>
                  <td>Tools like Mimikatz extract hashes from memory</td>
                  <td>Lateral movement</td>
                </tr>
              </tbody>
            </table>
          </div>

          <h2 id="pass-the-hash">Pass-the-Hash Attack</h2>

          <div class="code-block">
            <div class="code-header"><span class="code-language">Pass-the-Hash Example (Mimikatz)</span></div>
            <pre><code># Step 1: Extract NTLM hash from memory (requires admin on compromised machine)
mimikatz # sekurlsa::logonpasswords

# Output shows:
# Username: jsmith
# NTLM: a87f3a4f2d8c1b5e6a7d8c9e0f1a2b3c

# Step 2: Use hash to authenticate as that user (no password needed!)
mimikatz # sekurlsa::pth /user:jsmith /domain:corp.local /ntlm:a87f3a4f2d8c1b5e6a7d8c9e0f1a2b3c

# Now attacker has a shell running as jsmith
# This is why "hash = password" in NTLM</code></pre>
          </div>

          <h2 id="mitigations">Mitigations</h2>

          <div class="callout tip">
            <div class="callout-content">
              <div class="callout-title">âœ… Defending Against NTLM Attacks</div>
              <ul>
                <li><strong>Disable NTLM:</strong> Use Kerberos instead (GPO: Network Security: Restrict NTLM)</li>
                <li><strong>Credential Guard:</strong> Protects NTLM hashes in virtualized container (Windows 10/11)</li>
                <li><strong>Protected Users:</strong> Security group that disables NTLM for members</li>
                <li><strong>LAPS:</strong> Unique local admin passwords per machine</li>
                <li><strong>Tiered Admin:</strong> Domain admin creds never touch workstations</li>
                <li><strong>SMB Signing:</strong> Prevents NTLM relay attacks</li>
              </ul>
            </div>
          </div>

          <h2 id="interview-tips">Interview Tips</h2>
          <div class="callout interview">
            <div class="callout-content">
              <div class="callout-title">ğŸ’¡ Key Interview Points</div>
              <ul>
                <li><strong>NTLM is deprecated:</strong> Legacy protocol, use Kerberos when possible</li>
                <li><strong>Challenge-response:</strong> Server sends nonce, client responds with hash(password+nonce)</li>
                <li><strong>Pass-the-Hash:</strong> NTLM hash IS the credential, can authenticate without password</li>
                <li><strong>No mutual auth:</strong> Unlike Kerberos, client can't verify server identity</li>
                <li><strong>Defenses:</strong> Credential Guard, Protected Users group, disable NTLM via GPO</li>
              </ul>
            </div>
          </div>

          <nav class="page-nav">
            <a href="2-2-kerberos.html" class="page-nav-link prev">
              <span class="page-nav-label">â† Previous</span>
              <span class="page-nav-title">Kerberos</span>
            </a>
            <a href="2-4-saml.html" class="page-nav-link next">
              <span class="page-nav-label">Next â†’</span>
              <span class="page-nav-title">SAML</span>
            </a>
          </nav>
        </article>
      </div>
    </main>
  </div>
  <script src="main.js"></script>
</body>
</html>
