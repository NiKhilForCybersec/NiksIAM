<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OAuth 2.0 - Ultimate IAM Security Guide</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <div class="page-wrapper">
    <nav class="sidebar">
      <div class="sidebar-header">
        <a href="index.html" class="sidebar-logo">
          <div class="sidebar-logo-icon">ğŸ”</div>
          <div class="sidebar-logo-text">IAM <span>Guide</span></div>
        </a>
      </div>
    </nav>
    <main class="main-content">
      <div class="content-wrapper">
        <article class="content-main">
          <div class="badge badge-l2">L2 Technical</div>
          <h1>OAuth 2.0: Authorization Framework</h1>
          
          <div class="overview-box">
            <h3>ğŸ¯ What This Page Covers</h3>
            <p>OAuth 2.0 is the standard for API authorization. Understand grant types, when to use each, security considerations, and common implementation patterns.</p>
          </div>

          <div class="callout warning">
            <div class="callout-content">
              <div class="callout-title">âš ï¸ OAuth 2.0 is for Authorization, NOT Authentication</div>
              <p>OAuth grants access to resources. For authentication (login), use OpenID Connect (OIDC) which builds on OAuth 2.0.</p>
            </div>
          </div>

          <h2 id="core-concepts">Core Concepts</h2>

          <div class="table-wrapper">
            <table>
              <thead><tr><th>Role</th><th>Description</th><th>Example</th></tr></thead>
              <tbody>
                <tr>
                  <td><strong>Resource Owner</strong></td>
                  <td>User who owns the data</td>
                  <td>You (your Google Drive files)</td>
                </tr>
                <tr>
                  <td><strong>Client</strong></td>
                  <td>App requesting access</td>
                  <td>Third-party app wanting Drive access</td>
                </tr>
                <tr>
                  <td><strong>Authorization Server</strong></td>
                  <td>Issues tokens after auth</td>
                  <td>accounts.google.com</td>
                </tr>
                <tr>
                  <td><strong>Resource Server</strong></td>
                  <td>Hosts the protected resources</td>
                  <td>drive.googleapis.com</td>
                </tr>
              </tbody>
            </table>
          </div>

          <h2 id="grant-types">OAuth 2.0 Grant Types</h2>

          <h3>Authorization Code Flow (Recommended for Web Apps)</h3>
          <div class="flow-diagram">
            <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AUTHORIZATION CODE FLOW                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   USER              CLIENT                  AUTH SERVER             RESOURCE SERVER     â”‚
â”‚     â”‚                 â”‚                          â”‚                        â”‚             â”‚
â”‚     â”‚  1. Click       â”‚                          â”‚                        â”‚             â”‚
â”‚     â”‚    "Login"      â”‚                          â”‚                        â”‚             â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚                        â”‚             â”‚
â”‚     â”‚                 â”‚  2. Redirect to auth     â”‚                        â”‚             â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚     endpoint             â”‚                        â”‚             â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                        â”‚             â”‚
â”‚     â”‚                 â”‚  3. User authenticates   â”‚                        â”‚             â”‚
â”‚     â”‚                 â”‚     and consents         â”‚                        â”‚             â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚             â”‚
â”‚     â”‚  4. Redirect back with authorization code  â”‚                        â”‚             â”‚
â”‚     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚                        â”‚             â”‚
â”‚     â”‚                 â”‚  5. Exchange code for    â”‚                        â”‚             â”‚
â”‚     â”‚                 â”‚     tokens (server-side) â”‚                        â”‚             â”‚
â”‚     â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                        â”‚             â”‚
â”‚     â”‚                 â”‚  6. Access + Refresh     â”‚                        â”‚             â”‚
â”‚     â”‚                 â”‚     tokens               â”‚                        â”‚             â”‚
â”‚     â”‚                 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚             â”‚
â”‚     â”‚                 â”‚  7. API request with     â”‚                        â”‚             â”‚
â”‚     â”‚                 â”‚     access token         â”‚                        â”‚             â”‚
â”‚     â”‚                 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚             â”‚
â”‚     â”‚                 â”‚  8. Protected resource   â”‚                        â”‚             â”‚
â”‚     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </pre>
          </div>

          <div class="code-block">
            <div class="code-header"><span class="code-language">Authorization Code Flow URLs</span></div>
            <pre><code># Step 2: Redirect to Authorization Server
https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize?
  client_id=YOUR_CLIENT_ID
  &response_type=code
  &redirect_uri=https://yourapp.com/callback
  &scope=openid profile User.Read
  &state=random_state_value
  &code_challenge=BASE64_CHALLENGE      # PKCE
  &code_challenge_method=S256

# Step 4: Callback with code
https://yourapp.com/callback?
  code=AUTHORIZATION_CODE
  &state=random_state_value

# Step 5: Exchange code for tokens
POST https://login.microsoftonline.com/{tenant}/oauth2/v2.0/token
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code
&client_id=YOUR_CLIENT_ID
&client_secret=YOUR_CLIENT_SECRET
&code=AUTHORIZATION_CODE
&redirect_uri=https://yourapp.com/callback
&code_verifier=ORIGINAL_CODE_VERIFIER   # PKCE</code></pre>
          </div>

          <h3>Grant Type Comparison</h3>
          <div class="table-wrapper">
            <table>
              <thead><tr><th>Grant Type</th><th>Use Case</th><th>Security</th></tr></thead>
              <tbody>
                <tr>
                  <td><strong>Authorization Code + PKCE</strong></td>
                  <td>Web apps, SPAs, mobile apps</td>
                  <td>âœ… Most secure for user flows</td>
                </tr>
                <tr>
                  <td><strong>Client Credentials</strong></td>
                  <td>Machine-to-machine (no user)</td>
                  <td>âœ… Secure for backend services</td>
                </tr>
                <tr>
                  <td><strong>Device Code</strong></td>
                  <td>TVs, IoT, CLI tools</td>
                  <td>âœ… Good for input-limited devices</td>
                </tr>
                <tr>
                  <td><strong>Implicit (DEPRECATED)</strong></td>
                  <td>Legacy SPAs</td>
                  <td>âŒ Tokens in URL, insecure</td>
                </tr>
                <tr>
                  <td><strong>Resource Owner Password (DEPRECATED)</strong></td>
                  <td>Legacy migration only</td>
                  <td>âŒ Exposes user credentials to client</td>
                </tr>
              </tbody>
            </table>
          </div>

          <h2 id="client-credentials">Client Credentials Flow (M2M)</h2>
          <p>For backend services calling APIs without user context.</p>

          <div class="code-block">
            <div class="code-header"><span class="code-language">Client Credentials Example</span></div>
            <pre><code># Request token for service-to-service
POST https://login.microsoftonline.com/{tenant}/oauth2/v2.0/token
Content-Type: application/x-www-form-urlencoded

grant_type=client_credentials
&client_id=SERVICE_APP_ID
&client_secret=SERVICE_APP_SECRET
&scope=https://graph.microsoft.com/.default

# Response
{
  "token_type": "Bearer",
  "expires_in": 3599,
  "access_token": "eyJ0eXAiOiJKV1Q..."
}

# Use token to call API
GET https://graph.microsoft.com/v1.0/users
Authorization: Bearer eyJ0eXAiOiJKV1Q...</code></pre>
          </div>

          <h2 id="tokens">Token Types</h2>

          <div class="table-wrapper">
            <table>
              <thead><tr><th>Token</th><th>Purpose</th><th>Lifetime</th><th>Storage</th></tr></thead>
              <tbody>
                <tr>
                  <td><strong>Access Token</strong></td>
                  <td>Access protected resources</td>
                  <td>Short (1 hour typical)</td>
                  <td>Memory only (never persist)</td>
                </tr>
                <tr>
                  <td><strong>Refresh Token</strong></td>
                  <td>Get new access tokens</td>
                  <td>Long (days to months)</td>
                  <td>Secure storage (encrypted)</td>
                </tr>
                <tr>
                  <td><strong>ID Token (OIDC)</strong></td>
                  <td>Prove user identity</td>
                  <td>Short (1 hour typical)</td>
                  <td>Memory for session validation</td>
                </tr>
              </tbody>
            </table>
          </div>

          <h2 id="scopes">Scopes (Permissions)</h2>
          <p>Scopes define what actions the access token can perform.</p>

          <div class="code-block">
            <div class="code-header"><span class="code-language">Microsoft Graph Scopes</span></div>
            <pre><code># Delegated (user context)
User.Read           - Read current user profile
Mail.Read           - Read user's mail
Files.ReadWrite     - Full access to user's files
Calendars.ReadWrite - Full access to user's calendars

# Application (no user, service context)
User.Read.All       - Read all users (admin consent required)
Mail.Read           - Read all users' mail (admin consent)
Directory.Read.All  - Read directory data

# Request specific scopes
scope=openid profile User.Read Mail.Read</code></pre>
          </div>

          <h2 id="security">Security Best Practices</h2>
          <div class="callout tip">
            <div class="callout-content">
              <div class="callout-title">ğŸ”’ OAuth Security Checklist</div>
              <ul>
                <li><strong>Always use PKCE</strong> for public clients (SPAs, mobile apps)</li>
                <li><strong>Validate tokens</strong> - Check signature, issuer, audience, expiration</li>
                <li><strong>Use short-lived access tokens</strong> - 1 hour or less</li>
                <li><strong>Store refresh tokens securely</strong> - Encrypted, never in localStorage</li>
                <li><strong>Use state parameter</strong> - Prevent CSRF attacks</li>
                <li><strong>Validate redirect URIs</strong> - Exact match, no wildcards</li>
                <li><strong>Implement token revocation</strong> - Allow users to revoke access</li>
              </ul>
            </div>
          </div>

          <h2 id="interview-tips">Interview Tips</h2>
          <div class="callout interview">
            <div class="callout-content">
              <div class="callout-title">ğŸ’¡ Key Interview Points</div>
              <ul>
                <li><strong>OAuth is authorization, not authentication</strong> - Use OIDC for login</li>
                <li><strong>Know grant types:</strong> Authorization Code+PKCE (users), Client Credentials (M2M)</li>
                <li><strong>Implicit flow is deprecated</strong> - Always use Auth Code + PKCE for SPAs</li>
                <li><strong>Access tokens are short-lived</strong> - Use refresh tokens to get new ones</li>
                <li><strong>Scopes = permissions</strong> - Define what actions token can perform</li>
                <li><strong>PKCE prevents code interception</strong> - Required for public clients</li>
              </ul>
            </div>
          </div>

          <nav class="page-nav">
            <a href="2-4-saml.html" class="page-nav-link prev">
              <span class="page-nav-label">â† Previous</span>
              <span class="page-nav-title">SAML</span>
            </a>
            <a href="2-6-oidc.html" class="page-nav-link next">
              <span class="page-nav-label">Next â†’</span>
              <span class="page-nav-title">OpenID Connect</span>
            </a>
          </nav>
        </article>
      </div>
    </main>
  </div>
  <script src="main.js"></script>
</body>
</html>
