<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kerberos - Ultimate IAM Security Guide</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <div class="page-wrapper">
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" aria-label="Toggle navigation">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    <nav class="sidebar">
      <div class="sidebar-header">
        <a href="index.html" class="sidebar-logo">
          <div class="sidebar-logo-icon">ğŸ”</div>
          <div class="sidebar-logo-text">IAM <span>Guide</span></div>
        </a>
      </div>
      <!-- Navigation generated by JavaScript -->
    </nav>
    <main class="main-content">
      <div class="content-wrapper">
        <article class="content-main">
          <div class="badge badge-l2">L2 Technical</div>
          <h1>Kerberos</h1>
          
          <div class="overview-box">
            <h3>ğŸ¯ What You'll Learn</h3>
            <p>Kerberos is THE authentication protocol for Active Directory. If you work with Windows domains, you MUST understand this. This page breaks it down with simple analogies and memory tricks.</p>
          </div>

          <!-- MEMORY AID SECTION -->
          <h2 id="simple-analogy">ğŸ­ The Amusement Park Analogy</h2>
          <div class="callout tip"><div class="callout-content"><div class="callout-title">ğŸ¢ Think of Kerberos Like an Amusement Park</div>
            <p>Imagine you're visiting an amusement park. Here's how it maps to Kerberos:</p>
            
            <div class="flow-diagram"><pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ğŸ¢ AMUSEMENT PARK = KERBEROS                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                          â”‚
â”‚   YOU (Visitor)              =  CLIENT (User wanting to access resources)               â”‚
â”‚                                                                                          â”‚
â”‚   MAIN GATE                  =  KDC (Key Distribution Center)                           â”‚
â”‚   (Where you show your ID)      The central authority that issues tickets               â”‚
â”‚                                                                                          â”‚
â”‚   WRISTBAND                  =  TGT (Ticket Granting Ticket)                            â”‚
â”‚   (Proves you paid entry)       "I'm a valid user in this domain"                       â”‚
â”‚                                 You get this ONCE when you log in                       â”‚
â”‚                                                                                          â”‚
â”‚   RIDE TICKET                =  SERVICE TICKET                                          â”‚
â”‚   (For a specific ride)         "Let me access this specific server/service"            â”‚
â”‚                                 You get a NEW one for each service                      â”‚
â”‚                                                                                          â”‚
â”‚   THE ROLLERCOASTER          =  SERVICE (File server, web app, database)                â”‚
â”‚   (The ride you want)           What you actually want to access                        â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre></div>
          </div></div>

          <h2 id="flow-simple">ğŸ“ The Flow in Plain English</h2>
          <div class="callout info"><div class="callout-content"><div class="callout-title">ğŸš¶ Walk Through: "I want to access a file server"</div>
            
            <p><strong>Step 1: Morning Login (You enter the park)</strong></p>
            <p>You type your username and password at your Windows computer.</p>
            <ul>
              <li>Your computer sends a request to the Domain Controller (KDC)</li>
              <li>"Hi, I'm john.smith, here's proof I know my password"</li>
              <li>DC responds: "Welcome John! Here's your wristband (TGT)"</li>
            </ul>
            <p>âœ… <strong>You now have a TGT.</strong> Valid for 10 hours (default). You don't need to enter your password again today.</p>

            <p style="margin-top:1.5rem;"><strong>Step 2: Access File Server (You want to ride a rollercoaster)</strong></p>
            <p>You try to open \\fileserver\shared</p>
            <ul>
              <li>Your computer shows the TGT to the DC: "I have my wristband, can I get a ticket for the file server?"</li>
              <li>DC responds: "Here's your ride ticket (Service Ticket) for fileserver"</li>
            </ul>
            <p>âœ… <strong>You now have a Service Ticket</strong> specifically for that file server.</p>

            <p style="margin-top:1.5rem;"><strong>Step 3: Enter the File Server (Board the ride)</strong></p>
            <ul>
              <li>Your computer presents the Service Ticket to the file server</li>
              <li>File server checks the ticket: "This is valid, let them in!"</li>
            </ul>
            <p>âœ… <strong>You're in!</strong> The file server never saw your password.</p>
          </div></div>

          <!-- MEMORY TRICKS -->
          <h2 id="memory-tricks">ğŸ§  Memory Tricks</h2>
          <div class="callout warning"><div class="callout-content"><div class="callout-title">ğŸ’¡ Remember These Forever</div>
            
            <p><strong>ğŸ”‘ "TGT = The Golden Ticket"</strong></p>
            <p>Like Willy Wonka's golden ticket, your TGT is your all-access pass. Show it to get tickets for any ride (service) in the park (domain).</p>

            <p style="margin-top:1rem;"><strong>ğŸ« "Service Ticket = Specific Ticket"</strong></p>
            <p>Each service needs its own ticket. Want the file server? Get a ticket. Want SharePoint? Get another ticket. You collect tickets as you go.</p>

            <p style="margin-top:1rem;"><strong>ğŸ° "KDC = The King"</strong></p>
            <p>The Key Distribution Center is the KING of the domain. Only the King can create valid tickets. In AD, every Domain Controller is a KDC.</p>

            <p style="margin-top:1rem;"><strong>ğŸ” "krbtgt = The Crown Jewels"</strong></p>
            <p>The krbtgt account's password hash is used to encrypt ALL TGTs. If attackers steal this, they can forge any ticket (Golden Ticket attack). PROTECT IT!</p>

            <p style="margin-top:1rem;"><strong>ğŸ“¦ Encryption Rule:</strong></p>
            <ul>
              <li><strong>TGT</strong> = Encrypted with <strong>krbtgt</strong>'s key (only KDC can create/read)</li>
              <li><strong>Service Ticket</strong> = Encrypted with <strong>service account</strong>'s key (only that service can read)</li>
            </ul>
          </div></div>

          <!-- TECHNICAL DETAILS -->
          <h2 id="components">Kerberos Components</h2>
          <div class="table-wrapper"><table>
            <thead><tr><th>Component</th><th>What It Is</th><th>Memory Aid</th></tr></thead>
            <tbody>
              <tr><td><strong>KDC</strong></td><td>Key Distribution Center (runs on DC)</td><td>The "Ticket Booth" at the park entrance</td></tr>
              <tr><td><strong>AS</strong></td><td>Authentication Service (part of KDC)</td><td>The gate agent who checks your ID</td></tr>
              <tr><td><strong>TGS</strong></td><td>Ticket Granting Service (part of KDC)</td><td>The booth that gives ride tickets</td></tr>
              <tr><td><strong>TGT</strong></td><td>Ticket Granting Ticket</td><td>Your WRISTBAND (proves you paid)</td></tr>
              <tr><td><strong>Service Ticket</strong></td><td>Ticket for specific service</td><td>Your RIDE TICKET (for one specific ride)</td></tr>
              <tr><td><strong>krbtgt</strong></td><td>Built-in account for signing TGTs</td><td>The MASTER KEY to the kingdom</td></tr>
            </tbody>
          </table></div>

          <h2 id="technical-flow">Technical Flow (With Acronyms)</h2>
          <div class="flow-diagram"><pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    KERBEROS AUTHENTICATION FLOW                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                          â”‚
â”‚   CLIENT (You)                              KDC (Domain Controller)                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”‚
â”‚                                                                                          â”‚
â”‚   â‘   AS-REQ  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  AS (Authentication Service)               â”‚
â”‚       "I'm john.smith, here's my timestamp                                              â”‚
â”‚        encrypted with my password hash"                                                 â”‚
â”‚                                                                                          â”‚
â”‚   â‘¡  AS-REP  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚       "Here's your TGT (encrypted with krbtgt)                                         â”‚
â”‚        and a session key (encrypted with your key)"                                    â”‚
â”‚                                                                                          â”‚
â”‚   â‘¢  TGS-REQ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  TGS (Ticket Granting Service)             â”‚
â”‚       "Here's my TGT, I want a ticket                                                   â”‚
â”‚        for service: MSSQLSvc/sqlserver.corp.com"                                       â”‚
â”‚                                                                                          â”‚
â”‚   â‘£  TGS-REP â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚       "Here's your Service Ticket                                                       â”‚
â”‚        (encrypted with the SQL service account's key)"                                 â”‚
â”‚                                                                                          â”‚
â”‚   CLIENT                                    SERVICE (SQL Server)                        â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚                                                                                          â”‚
â”‚   â‘¤  AP-REQ  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                                            â”‚
â”‚       "Here's my Service Ticket, let me in"                                            â”‚
â”‚                                                                                          â”‚
â”‚   â‘¥  AP-REP  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚       "Ticket valid! Access granted!"                                                   â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MEMORY AID for the steps:
AS-REQ/AS-REP = "Authenticate me!" (Get your TGT)
TGS-REQ/TGS-REP = "Ticket please!" (Get Service Ticket)
AP-REQ/AP-REP = "Access please!" (Use the ticket)</pre></div>

          <h2 id="real-example">ğŸ“‹ Real-World Example: Accessing SQL Server</h2>
          <div class="code-block"><div class="code-header"><span class="code-language">What Actually Happens</span></div><pre><code># SCENARIO: User opens SQL Server Management Studio

1. USER LOGS INTO WINDOWS (8:00 AM)
   â””â”€â–º Gets TGT from Domain Controller
   â””â”€â–º TGT cached in memory (valid 10 hours until 6:00 PM)

2. USER OPENS SSMS AND CONNECTS TO SQLSERVER01 (8:15 AM)
   â””â”€â–º Computer checks: "Do I have a Service Ticket for MSSQLSvc/sqlserver01?"
   â””â”€â–º NO! So computer:
       â”œâ”€â–º Shows TGT to DC: "Give me a ticket for MSSQLSvc/sqlserver01"
       â”œâ”€â–º DC returns Service Ticket
       â””â”€â–º Computer presents Service Ticket to SQL Server
   â””â”€â–º SQL Server validates ticket â†’ CONNECTION ESTABLISHED!

3. USER ACCESSES FILE SERVER (8:30 AM)  
   â””â”€â–º Needs NEW Service Ticket for CIFS/fileserver01
   â””â”€â–º Same process: TGT â†’ DC â†’ Service Ticket â†’ File Server

# VIEW YOUR CURRENT TICKETS
klist

# OUTPUT SHOWS:
Cached Tickets: (3)

#0  Client: john.smith@CORP.COM
    Server: krbtgt/CORP.COM@CORP.COM        â† This is your TGT!
    Valid: 8:00 AM - 6:00 PM

#1  Client: john.smith@CORP.COM  
    Server: MSSQLSvc/sqlserver01@CORP.COM   â† Service Ticket for SQL
    
#2  Client: john.smith@CORP.COM
    Server: CIFS/fileserver01@CORP.COM      â† Service Ticket for Files</code></pre></div>

          <!-- ATTACKS SECTION WITH SIMPLE EXPLANATIONS -->
          <h2 id="attacks">ğŸ”´ Kerberos Attacks (Simplified)</h2>
          
          <div class="callout critical"><div class="callout-content"><div class="callout-title">ğŸ’€ Golden Ticket Attack</div>
            <p><strong>The Analogy:</strong> Imagine stealing the amusement park's wristband-making machine. You could create unlimited wristbands for anyone, even fake people, with VIP access to everything.</p>
            
            <p><strong>What it is:</strong> Attacker steals the <code>krbtgt</code> password hash and forges their own TGTs.</p>
            
            <p><strong>Why it's devastating:</strong></p>
            <ul>
              <li>Can impersonate ANY user (even Domain Admin)</li>
              <li>Can create tickets for users that don't exist</li>
              <li>Survives password resets (until krbtgt is reset TWICE)</li>
              <li>Valid for 10 years by default!</li>
            </ul>
            
            <p><strong>How to detect:</strong> TGT without matching AS-REQ in logs, unusually long ticket lifetime</p>
            <p><strong>How to fix:</strong> Reset krbtgt password TWICE (because of replication)</p>
          </div></div>

          <div class="callout warning"><div class="callout-content"><div class="callout-title">âš ï¸ Silver Ticket Attack</div>
            <p><strong>The Analogy:</strong> Instead of stealing the wristband machine, you steal the rollercoaster operator's stamp. You can only make fake tickets for THAT ride, not the whole park.</p>
            
            <p><strong>What it is:</strong> Attacker steals a service account's password hash and forges Service Tickets for that service only.</p>
            
            <p><strong>Why it's dangerous:</strong></p>
            <ul>
              <li>Doesn't touch the KDC (no logs!)</li>
              <li>Only affects one service</li>
              <li>Hard to detect</li>
            </ul>
            
            <p><strong>How to detect:</strong> Service access without matching TGS-REQ in KDC logs</p>
            <p><strong>How to prevent:</strong> Use Group Managed Service Accounts (gMSAs)</p>
          </div></div>

          <div class="callout info"><div class="callout-content"><div class="callout-title">ğŸ£ Kerberoasting</div>
            <p><strong>The Analogy:</strong> You legitimately buy a ride ticket, but then you examine it to figure out how the park makes their tickets. Then you crack the code offline.</p>
            
            <p><strong>What it is:</strong></p>
            <ol>
              <li>Attacker (any domain user) requests Service Tickets for services with SPNs</li>
              <li>Service Tickets are encrypted with the service account's password hash</li>
              <li>Attacker takes tickets offline and cracks them (hashcat, John the Ripper)</li>
              <li>Weak passwords crack quickly â†’ Attacker now has service account credentials</li>
            </ol>
            
            <p><strong>Prevention:</strong></p>
            <ul>
              <li>25+ character passwords on service accounts</li>
              <li>Use gMSAs (auto-rotating complex passwords)</li>
              <li>Monitor for mass TGS requests</li>
            </ul>
          </div></div>

          <h2 id="quick-reference">âš¡ Quick Reference Card</h2>
          <div class="code-block"><div class="code-header"><span class="code-language">Kerberos Cheat Sheet</span></div><pre><code>WHAT TO REMEMBER FOR INTERVIEWS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Kerberos uses TICKETS, not passwords on the network
âœ“ TGT = Master ticket (get once at login)
âœ“ Service Ticket = Per-service ticket (get for each resource)
âœ“ KDC = Domain Controller (issues all tickets)
âœ“ krbtgt = Account that encrypts all TGTs (THE crown jewels)

TICKET LIFETIMES (Defaults):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TGT: 10 hours
Service Ticket: 10 hours
Maximum renewal: 7 days

PORTS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TCP/UDP 88 = Kerberos

KEY ATTACKS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Golden Ticket = Forge TGT (need krbtgt hash)
Silver Ticket = Forge Service Ticket (need service hash)
Kerberoasting = Crack service account passwords offline
AS-REP Roasting = Crack accounts without pre-auth

POWERSHELL COMMANDS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
klist              # View cached tickets
klist purge        # Clear all tickets (force new ones)
klist tgt          # Show TGT details
setspn -L user     # List SPNs for an account</code></pre></div>

          <h2 id="interview-tips">Interview Tips</h2>
          <div class="callout interview"><div class="callout-content"><div class="callout-title">ğŸ’¡ How to Nail Kerberos Questions</div>
            
            <p><strong>If asked "Explain Kerberos":</strong></p>
            <p>"Kerberos is a ticket-based authentication protocol. When a user logs in, they get a TGT from the Domain Controller - think of it as a wristband that proves they're authenticated. When they need to access a resource like a file server, they show their TGT to get a Service Ticket for that specific server. The password never travels across the network."</p>

            <p style="margin-top:1rem;"><strong>If asked "Golden vs Silver Ticket":</strong></p>
            <p>"Golden Ticket is worse - the attacker has the krbtgt hash and can forge TGTs for any user, giving them complete domain control. Silver Ticket is limited - they only have a service account's hash, so they can only forge tickets for that one service. Golden Ticket requires resetting krbtgt twice to remediate."</p>

            <p style="margin-top:1rem;"><strong>If asked "What's Kerberoasting":</strong></p>
            <p>"Any domain user can request Service Tickets for SPNs. These tickets are encrypted with the service account's password hash. Attackers take them offline and crack them. The defense is using gMSAs or very long passwords on service accounts."</p>
          </div></div>

          <nav class="page-nav">
            <a href="2-1-authentication-factors.html" class="page-nav-link prev"><span class="page-nav-label">â† Previous</span><span class="page-nav-title">Authentication Factors</span></a>
            <a href="2-3-ntlm.html" class="page-nav-link next"><span class="page-nav-label">Next â†’</span><span class="page-nav-title">NTLM</span></a>
          </nav>
        </article>
      </div>
    </main>
  </div>
  <script src="main.js"></script>
</body>
</html>
