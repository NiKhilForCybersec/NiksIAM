<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Conditional Access - Ultimate IAM Security Guide</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <div class="page-wrapper">
    <nav class="sidebar">
      <div class="sidebar-header">
        <a href="index.html" class="sidebar-logo">
          <div class="sidebar-logo-icon">ğŸ”</div>
          <div class="sidebar-logo-text">IAM <span>Guide</span></div>
        </a>
      </div>
    </nav>
    <main class="main-content">
      <div class="content-wrapper">
        <article class="content-main">
          <div class="badge badge-l2">L2 Technical</div>
          <h1>Conditional Access: Zero Trust Policy Engine</h1>
          
          <div class="overview-box">
            <h3>ğŸ¯ What This Page Covers</h3>
            <p>Conditional Access is Microsoft's Zero Trust policy engine. Every sign-in is evaluated against policies that consider user, device, location, app, and risk. This is critical for enterprise security.</p>
          </div>

          <h2 id="how-it-works">How Conditional Access Works</h2>

          <div class="flow-diagram">
            <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONDITIONAL ACCESS EVALUATION FLOW                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                          â”‚
â”‚   USER SIGNS IN                                                                          â”‚
â”‚        â”‚                                                                                 â”‚
â”‚        â–¼                                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                     SIGNAL COLLECTION (Conditions)                               â”‚   â”‚
â”‚   â”‚  â€¢ User: Who? Groups? Roles? Risk level?                                        â”‚   â”‚
â”‚   â”‚  â€¢ Device: Compliant? Hybrid joined? Platform?                                  â”‚   â”‚
â”‚   â”‚  â€¢ Location: Named location? Country? IP range?                                 â”‚   â”‚
â”‚   â”‚  â€¢ Application: Which app? Client app type?                                     â”‚   â”‚
â”‚   â”‚  â€¢ Risk: Sign-in risk? User risk?                                               â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â”‚                                                                                 â”‚
â”‚        â–¼                                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                     POLICY EVALUATION                                            â”‚   â”‚
â”‚   â”‚                                                                                  â”‚   â”‚
â”‚   â”‚  FOR EACH applicable policy:                                                    â”‚   â”‚
â”‚   â”‚    IF all conditions match THEN apply access controls                           â”‚   â”‚
â”‚   â”‚                                                                                  â”‚   â”‚
â”‚   â”‚  Multiple policies can apply - most restrictive wins                            â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚        â”‚                                                                                 â”‚
â”‚        â–¼                                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                     ACCESS DECISION                                              â”‚   â”‚
â”‚   â”‚                                                                                  â”‚   â”‚
â”‚   â”‚  âœ… GRANT: Allow access (possibly with controls like MFA)                       â”‚   â”‚
â”‚   â”‚  âŒ BLOCK: Deny access completely                                                â”‚   â”‚
â”‚   â”‚  âš ï¸ GRANT with CONTROLS: Require MFA, compliant device, app protection, etc.   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </pre>
          </div>

          <h2 id="common-policies">Common CA Policies (Enterprise Baseline)</h2>

          <div class="table-wrapper">
            <table>
              <thead><tr><th>Policy Name</th><th>Conditions</th><th>Controls</th><th>Purpose</th></tr></thead>
              <tbody>
                <tr>
                  <td><strong>Require MFA for All Users</strong></td>
                  <td>All users, all cloud apps</td>
                  <td>Require MFA</td>
                  <td>Baseline protection</td>
                </tr>
                <tr>
                  <td><strong>Block Legacy Auth</strong></td>
                  <td>All users, legacy auth clients</td>
                  <td>Block</td>
                  <td>Prevent IMAP/POP/SMTP attacks</td>
                </tr>
                <tr>
                  <td><strong>Require Compliant Device</strong></td>
                  <td>All users, Office 365 apps</td>
                  <td>Require compliant device</td>
                  <td>Ensure managed devices</td>
                </tr>
                <tr>
                  <td><strong>Block High Risk Sign-ins</strong></td>
                  <td>All users, sign-in risk: High</td>
                  <td>Block</td>
                  <td>Stop compromised accounts</td>
                </tr>
                <tr>
                  <td><strong>Require MFA for Admins</strong></td>
                  <td>Directory roles (GA, etc.)</td>
                  <td>Require MFA + compliant device</td>
                  <td>Protect privileged access</td>
                </tr>
              </tbody>
            </table>
          </div>

          <h2 id="policy-example">Policy Deep Dive: Require MFA Outside Network</h2>

          <div class="code-block">
            <div class="code-header"><span class="code-language">CA Policy Configuration</span></div>
            <pre><code>Policy Name: "Require MFA for External Access"

ASSIGNMENTS:
  Users and Groups:
    Include: All users
    Exclude: Break-glass accounts, Service accounts
  
  Cloud Apps:
    Include: All cloud apps
    Exclude: None
  
  Conditions:
    Locations:
      Include: All locations
      Exclude: "Corporate Network" (named location: 10.0.0.0/8, office IPs)
    
    Device Platforms: All platforms
    Client Apps: Browser, Mobile apps and desktop clients

ACCESS CONTROLS:
  Grant:
    â˜‘ Require multi-factor authentication
    
  Session:
    Sign-in frequency: 12 hours

RESULT: 
  - On corporate network â†’ No MFA prompt
  - From home/coffee shop â†’ MFA required every 12 hours</code></pre>
          </div>

          <h2 id="named-locations">Named Locations Setup</h2>
          <div class="code-block">
            <div class="code-header"><span class="code-language">PowerShell: Create Named Locations</span></div>
            <pre><code># Connect to Microsoft Graph
Connect-MgGraph -Scopes "Policy.ReadWrite.ConditionalAccess"

# Create IP-based named location
$params = @{
    "@odata.type" = "#microsoft.graph.ipNamedLocation"
    displayName = "Corporate Network"
    isTrusted = $true
    ipRanges = @(
        @{ "@odata.type" = "#microsoft.graph.iPv4CidrRange"; cidrAddress = "10.0.0.0/8" }
        @{ "@odata.type" = "#microsoft.graph.iPv4CidrRange"; cidrAddress = "192.168.1.0/24" }
        @{ "@odata.type" = "#microsoft.graph.iPv4CidrRange"; cidrAddress = "203.0.113.50/32" }  # Office IP
    )
}
New-MgIdentityConditionalAccessNamedLocation -BodyParameter $params

# Create country-based named location
$countryParams = @{
    "@odata.type" = "#microsoft.graph.countryNamedLocation"
    displayName = "Blocked Countries"
    countriesAndRegions = @("KP", "IR", "RU", "CN")  # North Korea, Iran, Russia, China
    includeUnknownCountriesAndRegions = $false
}
New-MgIdentityConditionalAccessNamedLocation -BodyParameter $countryParams</code></pre>
          </div>

          <h2 id="troubleshooting">Troubleshooting CA Issues</h2>

          <div class="accordion">
            <div class="accordion-item">
              <button class="accordion-header">
                <span>ğŸ”´ User blocked but shouldn't be</span>
                <span class="accordion-icon">â–¼</span>
              </button>
              <div class="accordion-content">
                <div class="accordion-body">
                  <p><strong>Step 1:</strong> Check sign-in logs</p>
                  <div class="code-block">
                    <pre><code>Entra ID â†’ Sign-in logs â†’ Filter by user â†’ Click failed sign-in
Look at: 
  - "Conditional Access" tab â†’ Shows which policy blocked
  - "Basic info" tab â†’ Shows IP, device, location detected
  - "Device info" tab â†’ Shows compliance status</code></pre>
                  </div>
                  <p><strong>Step 2:</strong> Use What If tool</p>
                  <div class="code-block">
                    <pre><code>Entra ID â†’ Conditional Access â†’ What If
Select:
  - User: affected user
  - Cloud app: app they're accessing
  - IP address: their current IP
  - Device platform: their device
Click "What If" â†’ See which policies would apply</code></pre>
                  </div>
                </div>
              </div>
            </div>

            <div class="accordion-item">
              <button class="accordion-header">
                <span>ğŸŸ¡ User gets MFA prompt repeatedly</span>
                <span class="accordion-icon">â–¼</span>
              </button>
              <div class="accordion-content">
                <div class="accordion-body">
                  <p><strong>Common causes:</strong></p>
                  <ul>
                    <li>Sign-in frequency set too low</li>
                    <li>Persistent browser session disabled</li>
                    <li>Multiple CA policies conflicting</li>
                    <li>Token lifetime too short</li>
                  </ul>
                  <p><strong>Fix:</strong> Adjust session controls, use "persistent browser session" for trusted devices</p>
                </div>
              </div>
            </div>
          </div>

          <h2 id="interview-tips">Interview Tips</h2>
          <div class="callout interview">
            <div class="callout-content">
              <div class="callout-title">ğŸ’¡ Key Interview Points</div>
              <ul>
                <li><strong>CA = Zero Trust policy engine</strong> - evaluates every sign-in</li>
                <li><strong>Signals:</strong> User, device, location, app, risk</li>
                <li><strong>Controls:</strong> Block, require MFA, require compliant device, limit session</li>
                <li><strong>Know baseline policies:</strong> MFA for all, block legacy auth, require compliance</li>
                <li><strong>Troubleshooting:</strong> Sign-in logs + What If tool</li>
                <li><strong>Break-glass accounts:</strong> Always exclude from blocking policies</li>
              </ul>
            </div>
          </div>

          <nav class="page-nav">
            <a href="4-2-entra-objects.html" class="page-nav-link prev">
              <span class="page-nav-label">â† Previous</span>
              <span class="page-nav-title">Entra ID Objects</span>
            </a>
            <a href="4-4-entra-pim.html" class="page-nav-link next">
              <span class="page-nav-label">Next â†’</span>
              <span class="page-nav-title">Entra PIM</span>
            </a>
          </nav>
        </article>
      </div>
    </main>
  </div>
  <script src="main.js"></script>
</body>
</html>
