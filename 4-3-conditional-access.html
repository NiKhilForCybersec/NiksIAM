<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Conditional Access - Ultimate IAM Security Guide</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <div class="page-wrapper">
    <button class="mobile-menu-toggle" aria-label="Toggle navigation">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    <nav class="sidebar">
      <div class="sidebar-header">
        <a href="index.html" class="sidebar-logo">
          <div class="sidebar-logo-icon">ğŸ”</div>
          <div class="sidebar-logo-text">IAM <span>Guide</span></div>
        </a>
      </div>
    </nav>
    <main class="main-content">
      <div class="content-wrapper">
        <article class="content-main">
          <div class="badge badge-l2">L2 Technical</div>
          <h1>Conditional Access</h1>
          
          <div class="overview-box">
            <h3>ğŸ¯ What You'll Learn</h3>
            <p>Conditional Access is Microsoft's Zero Trust enforcement engine. It's basically an IF-THEN security policy: IF these conditions are true, THEN require/block this. Master this and you master Entra ID security.</p>
          </div>

          <!-- THE SIMPLE FORMULA -->
          <h2 id="formula">ğŸ§® The Simple Formula</h2>
          <div class="callout tip"><div class="callout-content"><div class="callout-title">Conditional Access = IF â†’ THEN</div>
            
            <div class="flow-diagram"><pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONDITIONAL ACCESS FORMULA                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                          â”‚
â”‚    IF                                 THEN                                              â”‚
â”‚    â”€â”€                                 â”€â”€â”€â”€                                              â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚    â”‚ WHO + WHAT + WHERE +     â”‚      â”‚ GRANT ACCESS             â”‚                      â”‚
â”‚    â”‚ DEVICE + RISK            â”‚  â†’   â”‚ (with requirements)      â”‚                      â”‚
â”‚    â”‚                          â”‚      â”‚ OR                       â”‚                      â”‚
â”‚    â”‚ (Assignments)            â”‚      â”‚ BLOCK ACCESS             â”‚                      â”‚
â”‚    â”‚ (Conditions)             â”‚      â”‚                          â”‚                      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                                          â”‚
â”‚    EXAMPLE IN ENGLISH:                                                                  â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚
â”‚    IF a user from the "Sales" group                                                     â”‚
â”‚    tries to access "Salesforce"                                                         â”‚
â”‚    from an unmanaged device                                                             â”‚
â”‚    outside the corporate network                                                        â”‚
â”‚                                                                                          â”‚
â”‚    THEN require MFA + compliant device                                                  â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre></div>
          </div></div>

          <!-- MEMORY TRICKS -->
          <h2 id="memory-tricks">ğŸ§  Memory Tricks</h2>
          <div class="callout warning"><div class="callout-content"><div class="callout-title">ğŸ’¡ Remember These Forever</div>
            
            <p><strong>ğŸš¦ "CA = Traffic Cop"</strong></p>
            <p>Conditional Access is like a traffic cop at an intersection. Based on conditions (time of day, type of vehicle, license plate), they decide: Go through, Stop and show ID, or You can't pass.</p>

            <p style="margin-top:1rem;"><strong>ğŸ“ "Assignments = WHO and WHAT"</strong></p>
            <ul>
              <li><strong>Users:</strong> Who is this policy for?</li>
              <li><strong>Apps:</strong> What apps does this apply to?</li>
            </ul>

            <p style="margin-top:1rem;"><strong>ğŸŒ "Conditions = CONTEXT"</strong></p>
            <ul>
              <li><strong>Where:</strong> Location (IP, country)</li>
              <li><strong>Device:</strong> Managed? Compliant? Platform?</li>
              <li><strong>Risk:</strong> User risk? Sign-in risk?</li>
              <li><strong>Client app:</strong> Browser? Mobile app? Legacy?</li>
            </ul>

            <p style="margin-top:1rem;"><strong>âœ… "Grant = WHAT'S REQUIRED"</strong></p>
            <ul>
              <li>Require MFA</li>
              <li>Require compliant device</li>
              <li>Require Hybrid Azure AD Join</li>
              <li>Block access</li>
            </ul>
          </div></div>

          <!-- POLICY STRUCTURE -->
          <h2 id="structure">ğŸ“‹ Policy Structure</h2>
          <div class="code-block"><div class="code-header"><span class="code-language">Building a CA Policy</span></div><pre><code># EVERY CA POLICY HAS THESE PARTS:

1. NAME
   â””â”€ "Require MFA for Admins"

2. ASSIGNMENTS (WHO + WHAT)
   â”œâ”€ Users/Groups: Include "Global Admins", Exclude "Break-Glass"
   â””â”€ Cloud Apps: "All cloud apps" or specific apps

3. CONDITIONS (WHEN/WHERE)
   â”œâ”€ Locations: "Any location" except "Trusted IPs"
   â”œâ”€ Device platforms: Windows, iOS, Android, macOS
   â”œâ”€ Device state: Compliant, Hybrid Joined
   â”œâ”€ Client apps: Browser, Mobile apps, Legacy
   â”œâ”€ Sign-in risk: Low, Medium, High
   â””â”€ User risk: Low, Medium, High

4. GRANT CONTROLS (THEN DO THIS)
   â”œâ”€ Block access
   â””â”€ Grant access (with requirements):
       â”œâ”€ Require MFA
       â”œâ”€ Require compliant device
       â”œâ”€ Require Hybrid AD joined
       â”œâ”€ Require approved app
       â””â”€ Require app protection policy

5. SESSION CONTROLS (OPTIONAL)
   â”œâ”€ Sign-in frequency
   â”œâ”€ Persistent browser session
   â””â”€ Cloud App Security (now Defender for Cloud Apps)</code></pre></div>

          <!-- COMMON POLICIES -->
          <h2 id="common-policies">ğŸ¯ Must-Have Policies</h2>
          <div class="table-wrapper"><table>
            <thead><tr><th>Policy Name</th><th>Purpose</th><th>Configuration</th></tr></thead>
            <tbody>
              <tr><td><strong>MFA for Admins</strong></td><td>Protect admin accounts</td><td>IF Admin role â†’ THEN require MFA always</td></tr>
              <tr><td><strong>Block Legacy Auth</strong></td><td>Stop password spray</td><td>IF legacy client â†’ THEN block (no MFA support!)</td></tr>
              <tr><td><strong>Require MFA Outside Network</strong></td><td>Trust office, verify external</td><td>IF not trusted IP â†’ THEN require MFA</td></tr>
              <tr><td><strong>Block High Risk Sign-in</strong></td><td>Stop active attacks</td><td>IF high sign-in risk â†’ THEN block</td></tr>
              <tr><td><strong>Require Compliant Device</strong></td><td>Only managed devices</td><td>IF sensitive app â†’ THEN require compliant device</td></tr>
            </tbody>
          </table></div>

          <!-- REAL EXAMPLE -->
          <h2 id="real-example">ğŸ“‹ Real Policy Example</h2>
          <div class="code-block"><div class="code-header"><span class="code-language">Block Legacy Authentication</span></div><pre><code># POLICY: Block Legacy Authentication
# WHY: Legacy protocols (IMAP, POP3, SMTP) don't support MFA
#      Perfect target for password spray attacks!

Name: Block Legacy Authentication

ASSIGNMENTS:
â”œâ”€â”€ Users: 
â”‚   â”œâ”€â”€ Include: All users
â”‚   â””â”€â”€ Exclude: Break-glass accounts (just in case)
â”œâ”€â”€ Cloud Apps:
â”‚   â””â”€â”€ Include: All cloud apps

CONDITIONS:
â”œâ”€â”€ Client apps:
â”‚   â””â”€â”€ Include: Exchange ActiveSync clients, Other clients
â”‚   (These are the legacy protocols)

GRANT:
â””â”€â”€ Block access

# RESULT: Any attempt to use IMAP, POP3, SMTP = BLOCKED
# Users must use modern auth (Outlook, OWA)</code></pre></div>

          <!-- EVALUATION ORDER -->
          <h2 id="evaluation">âš™ï¸ How Policies Are Evaluated</h2>
          <div class="callout info"><div class="callout-content"><div class="callout-title">Policy Evaluation Logic</div>
            
            <p><strong>Key Rules:</strong></p>
            <ol>
              <li><strong>All applicable policies are evaluated</strong> - Not just the first match</li>
              <li><strong>Block wins</strong> - If ANY policy says block, access is blocked</li>
              <li><strong>All grants must be satisfied</strong> - If Policy A requires MFA and Policy B requires compliant device, user needs BOTH</li>
              <li><strong>Exclusions are evaluated first</strong> - If you're excluded from a policy, it doesn't apply</li>
            </ol>

            <p style="margin-top:1rem;"><strong>Example:</strong></p>
            <p>User John tries to access SharePoint:</p>
            <ul>
              <li>Policy 1: All users â†’ SharePoint â†’ Require MFA âœ“</li>
              <li>Policy 2: Finance group â†’ All apps â†’ Require compliant device âœ“</li>
              <li>Policy 3: Block if outside US â†’ Not triggered (John is in US)</li>
            </ul>
            <p><strong>Result:</strong> John needs MFA AND compliant device</p>
          </div></div>

          <!-- TROUBLESHOOTING -->
          <h2 id="troubleshooting">ğŸ”§ Troubleshooting CA</h2>
          <div class="code-block"><div class="code-header"><span class="code-language">Debugging Conditional Access</span></div><pre><code># USER SAYS: "I can't access the app!"

STEP 1: CHECK SIGN-IN LOGS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Entra ID â†’ Sign-in logs â†’ Find the failed sign-in
Look at: 
- "Conditional Access" tab (which policies applied?)
- "Failure reason" 
- "Device info"

STEP 2: USE WHAT-IF TOOL
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Entra ID â†’ Conditional Access â†’ What If
Select:
- User: john@company.com
- App: SharePoint Online
- Location: Current IP
Click "What If" â†’ See which policies would apply

STEP 3: COMMON ISSUES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
"MFA required but can't complete"
â†’ Check MFA methods registered
â†’ Check if user is in scope of MFA registration policy

"Compliant device required"  
â†’ Check Intune enrollment
â†’ Check compliance policies in Intune
â†’ Device might be compliant but sync delayed

"Blocked unexpectedly"
â†’ Check for overlapping Block policies
â†’ Check client app type (legacy?)
â†’ Check if sign-in risk was elevated

STEP 4: REPORT-ONLY MODE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Before enabling a new policy:
1. Set to "Report-only" mode
2. Wait a week, check sign-in logs
3. See who would be affected
4. Then enable</code></pre></div>

          <!-- INTERVIEW TIPS -->
          <h2 id="interview-tips">Interview Tips</h2>
          <div class="callout interview"><div class="callout-content"><div class="callout-title">ğŸ’¡ How to Nail CA Questions</div>
            
            <p><strong>If asked "What is Conditional Access?":</strong></p>
            <p>"Conditional Access is Microsoft's Zero Trust policy engine in Entra ID. It works on an IF-THEN model: IF certain conditions are met - like user, app, location, device state, or risk level - THEN enforce specific controls like requiring MFA, requiring a compliant device, or blocking access entirely. It's how you implement 'never trust, always verify' in Microsoft's cloud."</p>

            <p style="margin-top:1rem;"><strong>If asked "What policies would you implement first?":</strong></p>
            <p>"I'd start with: 1) Require MFA for all administrators, 2) Block legacy authentication completely since it can't do MFA and is the main vector for password spray attacks, 3) Require MFA for all users from non-trusted locations, and 4) Block access for high-risk sign-ins detected by Identity Protection."</p>

            <p style="margin-top:1rem;"><strong>If asked "How do you troubleshoot CA issues?":</strong></p>
            <p>"First, check the sign-in logs for the specific failure - the Conditional Access tab shows exactly which policies applied and what failed. Then use the What-If tool to simulate the scenario. Common issues are device compliance sync delays, legacy auth clients, or unexpected risk scores. Always test new policies in Report-only mode first."</p>
          </div></div>

          <h2 id="quick-reference">âš¡ Quick Reference Card</h2>
          <div class="code-block"><div class="code-header"><span class="code-language">CA Cheat Sheet</span></div><pre><code>CONDITIONAL ACCESS = IF conditions â†’ THEN action

STRUCTURE:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Assignments (WHO + WHAT)
â”œâ”€â”€ Users/Groups
â””â”€â”€ Cloud Apps

Conditions (CONTEXT)
â”œâ”€â”€ Locations
â”œâ”€â”€ Device platforms
â”œâ”€â”€ Device state
â”œâ”€â”€ Client apps
â”œâ”€â”€ Sign-in risk
â””â”€â”€ User risk

Grant Controls (ACTION)
â”œâ”€â”€ Block
â””â”€â”€ Grant (require MFA, compliant device, etc.)

EVALUATION RULES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- All policies evaluated (not just first match)
- Block ALWAYS wins
- Multiple grants = ALL must be satisfied
- Exclusions evaluated first

DEBUGGING:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Sign-in logs â†’ Conditional Access tab
2. What-If tool
3. Report-only mode for new policies

MUST-HAVE POLICIES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. MFA for admins
2. Block legacy auth
3. MFA for risky sign-ins
4. Block high-risk sign-ins</code></pre></div>

          <nav class="page-nav">
            <a href="4-2-entra-objects.html" class="page-nav-link prev"><span class="page-nav-label">â† Previous</span><span class="page-nav-title">Entra ID Objects</span></a>
            <a href="4-4-entra-pim.html" class="page-nav-link next"><span class="page-nav-label">Next â†’</span><span class="page-nav-title">Entra PIM</span></a>
          </nav>
        </article>
      </div>
    </main>
  </div>
  <script src="main.js"></script>
</body>
</html>
