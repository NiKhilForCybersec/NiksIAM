<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Okta Authorization - Ultimate IAM Security Guide</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <div class="page-wrapper">
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" aria-label="Toggle navigation">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    <nav class="sidebar">
      <div class="sidebar-header">
        <a href="index.html" class="sidebar-logo">
          <div class="sidebar-logo-icon">ğŸ”</div>
          <div class="sidebar-logo-text">IAM <span>Guide</span></div>
        </a>
      </div>
      <!-- Navigation generated by JavaScript -->
    </nav>
    <main class="main-content">
      <div class="content-wrapper">
        <article class="content-main">
          <div class="badge badge-l2">L2 Technical</div>
          <h1>Okta Authorization</h1>
          
          <div class="overview-box">
            <h3>ğŸ¯ What This Page Covers</h3>
            <p>Okta's authorization capabilities including Authorization Servers, custom scopes, claims, and OAuth/OIDC for API protection.</p>
          </div>

          <h2 id="auth-servers">Authorization Servers</h2>
          <div class="table-wrapper"><table>
            <thead><tr><th>Type</th><th>Issuer URL</th><th>Use Case</th></tr></thead>
            <tbody>
              <tr><td><strong>Org Authorization Server</strong></td><td>https://{yourOrg}.okta.com</td><td>Okta APIs, legacy apps</td></tr>
              <tr><td><strong>Custom Authorization Server</strong></td><td>https://{yourOrg}.okta.com/oauth2/{authServerId}</td><td>Your APIs (recommended)</td></tr>
              <tr><td><strong>Default Custom</strong></td><td>https://{yourOrg}.okta.com/oauth2/default</td><td>Quick start, testing</td></tr>
            </tbody>
          </table></div>

          <h2 id="scopes-claims">Scopes and Claims</h2>
          <div class="code-block"><div class="code-header"><span class="code-language">Custom Authorization Server Configuration</span></div><pre><code># STANDARD OIDC SCOPES (built-in)
openid     â†’ sub (subject/user ID)
profile    â†’ name, family_name, given_name, nickname, picture
email      â†’ email, email_verified
address    â†’ address object
phone      â†’ phone_number, phone_number_verified

# CUSTOM SCOPES (you define for your APIs)
Security â†’ API â†’ Authorization Servers â†’ {Your Server} â†’ Scopes

Example Custom Scopes:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scope Name     â”‚ Description                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ api:read       â”‚ Read access to API                     â”‚
â”‚ api:write      â”‚ Write access to API                    â”‚
â”‚ admin          â”‚ Administrative operations              â”‚
â”‚ reports:view   â”‚ View reports                           â”‚
â”‚ users:manage   â”‚ Manage user accounts                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

# CUSTOM CLAIMS (add user attributes to token)
Security â†’ API â†’ Authorization Servers â†’ {Your Server} â†’ Claims

Example: Add department to access token
Name: department
Include in: Access Token
Value type: Expression
Value: user.department
Include with scope: api:read</code></pre></div>

          <h2 id="access-policies">Access Policies</h2>
          <div class="code-block"><div class="code-header"><span class="code-language">Authorization Server Policies</span></div><pre><code># ACCESS POLICIES control who can get tokens and what scopes

Security â†’ API â†’ Authorization Servers â†’ {Server} â†’ Access Policies

POLICY: "Internal API Access"
â”œâ”€â”€ Assigned to: Internal-Users group
â””â”€â”€ Rules:
    â”œâ”€â”€ Rule 1: "Standard Access"
    â”‚   â”œâ”€â”€ IF: Grant type is Authorization Code
    â”‚   â”œâ”€â”€ AND: User is member of All-Employees
    â”‚   â”œâ”€â”€ THEN: Grant scopes: openid, profile, api:read
    â”‚   â””â”€â”€ Token lifetime: Access=1hr, Refresh=8hr
    â”‚
    â””â”€â”€ Rule 2: "Admin Access"
        â”œâ”€â”€ IF: Grant type is Authorization Code  
        â”œâ”€â”€ AND: User is member of API-Admins
        â”œâ”€â”€ THEN: Grant scopes: openid, profile, api:read, api:write, admin
        â””â”€â”€ Token lifetime: Access=30min, Refresh=4hr

# POLICY ORDER MATTERS - first matching rule wins</code></pre></div>

          <h2 id="token-example">Token Structure</h2>
          <div class="code-block"><div class="code-header"><span class="code-language">Access Token Claims</span></div><pre><code># DECODED ACCESS TOKEN (JWT)
{
  "ver": 1,
  "jti": "AT.abc123...",
  "iss": "https://company.okta.com/oauth2/default",
  "aud": "api://myapi",
  "iat": 1704067200,
  "exp": 1704070800,
  "cid": "0oa1234...",           // Client ID
  "uid": "00u5678...",           // User ID
  "scp": [                       // Granted scopes
    "openid",
    "profile", 
    "api:read"
  ],
  "sub": "john.smith@company.com",
  "department": "Engineering",    // Custom claim
  "groups": [                     // Group claim (if configured)
    "Everyone",
    "Engineering-Team"
  ]
}

# API validates:
# 1. Signature (using Okta's public keys from JWKS)
# 2. Issuer matches expected
# 3. Audience matches this API
# 4. Token not expired
# 5. Required scopes present</code></pre></div>

          <h2 id="day-to-day">ğŸ”§ Security Engineer Day-to-Day Tasks</h2>
          <div class="callout tip"><div class="callout-content"><div class="callout-title">ğŸ‘¨â€ğŸ’» What You Actually Do</div>
            
            <p><strong>Authorization Server Management:</strong></p>
            <ul>
              <li>Create custom authorization servers for new APIs</li>
              <li>Define scopes based on API requirements</li>
              <li>Configure claims to include user attributes</li>
              <li>Set up access policies for different user groups</li>
            </ul>

            <p><strong>Troubleshooting:</strong></p>
            <ul>
              <li><strong>"Token missing scope"</strong> â†’ Check access policy rules, group membership</li>
              <li><strong>"Invalid audience"</strong> â†’ Verify audience configured correctly</li>
              <li><strong>"Token expired"</strong> â†’ Review token lifetime settings</li>
              <li><strong>"Missing claim"</strong> â†’ Check claim configuration and conditions</li>
            </ul>

            <p><strong>Security Reviews:</strong></p>
            <ul>
              <li>Audit scope definitions (are any too broad?)</li>
              <li>Review access policies periodically</li>
              <li>Monitor token usage in System Log</li>
              <li>Verify token lifetimes are appropriate</li>
            </ul>
          </div></div>

          <h2 id="interview-tips">Interview Tips</h2>
          <div class="callout interview"><div class="callout-content"><div class="callout-title">ğŸ’¡ Key Interview Points</div>
            <ul>
              <li><strong>Authorization Server:</strong> Issues OAuth/OIDC tokens for your APIs</li>
              <li><strong>Scopes:</strong> Define what access the token grants (api:read, api:write)</li>
              <li><strong>Claims:</strong> User attributes included in token (department, groups)</li>
              <li><strong>Access Policies:</strong> Control who can get which scopes</li>
              <li><strong>Custom vs Org:</strong> Use custom auth server for your APIs</li>
            </ul>
          </div></div>

          <nav class="page-nav">
            <a href="5-2-okta-authentication.html" class="page-nav-link prev"><span class="page-nav-label">â† Previous</span><span class="page-nav-title">Okta Authentication</span></a>
            <a href="5-4-okta-lifecycle.html" class="page-nav-link next"><span class="page-nav-label">Next â†’</span><span class="page-nav-title">Okta Lifecycle</span></a>
          </nav>
        </article>
      </div>
    </main>
  </div>
  <script src="main.js"></script>
</body>
</html>
