<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SAML Federation - Ultimate IAM Security Guide</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <div class="page-wrapper">
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" aria-label="Toggle navigation">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    <nav class="sidebar">
      <div class="sidebar-header">
        <a href="index.html" class="sidebar-logo">
          <div class="sidebar-logo-icon">üîê</div>
          <div class="sidebar-logo-text">IAM <span>Guide</span></div>
        </a>
      </div>
      <!-- Navigation generated by JavaScript -->
    </nav>
    <main class="main-content">
      <div class="content-wrapper">
        <article class="content-main">
          <div class="badge badge-l2">L2 Technical</div>
          <h1>SAML Federation</h1>
          
          <div class="overview-box">
            <h3>üéØ What This Page Covers</h3>
            <p>Deep dive into SAML-based federation including metadata exchange, assertion structure, claims mapping, and troubleshooting federation issues.</p>
          </div>

          <h2 id="saml-assertion">SAML Assertion Structure</h2>
          <div class="code-block"><div class="code-header"><span class="code-language">SAML Assertion (Simplified XML)</span></div><pre><code>&lt;saml:Assertion xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion"&gt;
  &lt;!-- WHO issued this assertion --&gt;
  &lt;saml:Issuer&gt;https://idp.company.com&lt;/saml:Issuer&gt;
  
  &lt;!-- Digital signature (proves assertion wasn't tampered) --&gt;
  &lt;ds:Signature&gt;...&lt;/ds:Signature&gt;
  
  &lt;!-- WHO the assertion is about --&gt;
  &lt;saml:Subject&gt;
    &lt;saml:NameID Format="emailAddress"&gt;user@company.com&lt;/saml:NameID&gt;
    &lt;saml:SubjectConfirmation Method="bearer"&gt;
      &lt;saml:SubjectConfirmationData 
        NotOnOrAfter="2024-01-01T12:05:00Z"
        Recipient="https://app.example.com/saml/acs"/&gt;
    &lt;/saml:SubjectConfirmation&gt;
  &lt;/saml:Subject&gt;
  
  &lt;!-- WHEN the assertion is valid --&gt;
  &lt;saml:Conditions NotBefore="2024-01-01T12:00:00Z" 
                   NotOnOrAfter="2024-01-01T12:05:00Z"&gt;
    &lt;saml:AudienceRestriction&gt;
      &lt;saml:Audience&gt;https://app.example.com&lt;/saml:Audience&gt;
    &lt;/saml:AudienceRestriction&gt;
  &lt;/saml:Conditions&gt;
  
  &lt;!-- HOW the user authenticated --&gt;
  &lt;saml:AuthnStatement AuthnInstant="2024-01-01T12:00:00Z"&gt;
    &lt;saml:AuthnContext&gt;
      &lt;saml:AuthnContextClassRef&gt;
        urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport
      &lt;/saml:AuthnContextClassRef&gt;
    &lt;/saml:AuthnContext&gt;
  &lt;/saml:AuthnStatement&gt;
  
  &lt;!-- WHAT attributes/claims about the user --&gt;
  &lt;saml:AttributeStatement&gt;
    &lt;saml:Attribute Name="firstName"&gt;
      &lt;saml:AttributeValue&gt;Sarah&lt;/saml:AttributeValue&gt;
    &lt;/saml:Attribute&gt;
    &lt;saml:Attribute Name="groups"&gt;
      &lt;saml:AttributeValue&gt;Finance-Team&lt;/saml:AttributeValue&gt;
      &lt;saml:AttributeValue&gt;All-Employees&lt;/saml:AttributeValue&gt;
    &lt;/saml:Attribute&gt;
  &lt;/saml:AttributeStatement&gt;
&lt;/saml:Assertion&gt;</code></pre></div>

          <h2 id="metadata">SAML Metadata</h2>
          <div class="table-wrapper"><table>
            <thead><tr><th>Element</th><th>IdP Metadata</th><th>SP Metadata</th></tr></thead>
            <tbody>
              <tr><td><strong>Entity ID</strong></td><td>IdP identifier</td><td>SP identifier</td></tr>
              <tr><td><strong>SSO URL</strong></td><td>Where SP sends AuthnRequest</td><td>-</td></tr>
              <tr><td><strong>ACS URL</strong></td><td>-</td><td>Where IdP sends Response</td></tr>
              <tr><td><strong>SLO URL</strong></td><td>Single logout endpoint</td><td>Single logout endpoint</td></tr>
              <tr><td><strong>Certificate</strong></td><td>Signing cert (public key)</td><td>Encryption cert (optional)</td></tr>
              <tr><td><strong>NameID Format</strong></td><td>Supported formats</td><td>Required format</td></tr>
            </tbody>
          </table></div>

          <h2 id="claims-mapping">Claims Mapping</h2>
          <div class="code-block"><div class="code-header"><span class="code-language">Common SAML Claim Mappings</span></div><pre><code># IdP Attribute          ‚Üí  SP Expected Claim
user.email               ‚Üí  http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress
user.firstName           ‚Üí  http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname
user.lastName            ‚Üí  http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname
user.displayName         ‚Üí  http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name
user.groups              ‚Üí  http://schemas.microsoft.com/ws/2008/06/identity/claims/groups
user.employeeId          ‚Üí  http://schemas.xmlsoap.org/ws/2005/05/identity/claims/employeeid

# NameID Formats
urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress     # user@domain.com
urn:oasis:names:tc:SAML:2.0:nameid-format:persistent       # Opaque ID (privacy)
urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified     # App decides</code></pre></div>

          <h2 id="troubleshooting">Common Issues</h2>
          <div class="table-wrapper"><table>
            <thead><tr><th>Error</th><th>Cause</th><th>Fix</th></tr></thead>
            <tbody>
              <tr><td><strong>Invalid Signature</strong></td><td>Wrong cert, modified assertion</td><td>Re-import IdP metadata/cert</td></tr>
              <tr><td><strong>Audience Mismatch</strong></td><td>SP Entity ID doesn't match</td><td>Verify Entity IDs match exactly</td></tr>
              <tr><td><strong>Time Skew</strong></td><td>Server clocks out of sync</td><td>Sync NTP, check time conditions</td></tr>
              <tr><td><strong>Missing Attribute</strong></td><td>Claim not mapped/released</td><td>Configure attribute release in IdP</td></tr>
              <tr><td><strong>ACS URL Mismatch</strong></td><td>Redirect URL wrong</td><td>Update ACS URL in IdP config</td></tr>
            </tbody>
          </table></div>

          <h2 id="interview-tips">Interview Tips</h2>
          <div class="callout interview"><div class="callout-content"><div class="callout-title">üí° Key Interview Points</div>
            <ul>
              <li><strong>Assertion:</strong> Signed XML containing user identity and attributes</li>
              <li><strong>Metadata:</strong> XML describing IdP/SP endpoints and certificates</li>
              <li><strong>Entity ID:</strong> Unique identifier for IdP or SP (often a URL)</li>
              <li><strong>ACS URL:</strong> Assertion Consumer Service - where IdP posts response</li>
              <li><strong>Troubleshooting:</strong> Use browser dev tools, SAML tracer extension</li>
            </ul>
          </div></div>

          <nav class="page-nav">
            <a href="3-1-federation-fundamentals.html" class="page-nav-link prev"><span class="page-nav-label">‚Üê Previous</span><span class="page-nav-title">Federation Fundamentals</span></a>
            <a href="3-3-oidc-federation.html" class="page-nav-link next"><span class="page-nav-label">Next ‚Üí</span><span class="page-nav-title">OIDC Federation</span></a>
          </nav>
        </article>
      </div>
    </main>
  </div>
  <script src="main.js"></script>
</body>
</html>
