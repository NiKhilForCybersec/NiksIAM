<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Protocol Flows - Ultimate IAM Security Guide</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <div class="page-wrapper">
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" aria-label="Toggle navigation">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    <nav class="sidebar">
      <div class="sidebar-header">
        <a href="index.html" class="sidebar-logo">
          <div class="sidebar-logo-icon">🔐</div>
          <div class="sidebar-logo-text">IAM <span>Guide</span></div>
        </a>
      </div>
      <!-- Navigation generated by JavaScript -->
    </nav>
    <main class="main-content">
      <div class="content-wrapper">
        <article class="content-main">
          <div class="badge badge-l2">L2 Technical</div>
          <h1>Protocol Flow Diagrams</h1>
          
          <div class="overview-box">
            <h3>🎯 Quick Reference</h3>
            <p>Visual flow diagrams for authentication protocols. Great for interview prep and troubleshooting.</p>
          </div>

          <h2 id="saml">SAML 2.0 SP-Initiated Flow</h2>
          <div class="flow-diagram"><pre>
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                    SAML SP-INITIATED SSO                                                 │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│   USER               SERVICE PROVIDER (SP)              IDENTITY PROVIDER (IdP)         │
│     │                      │                                   │                        │
│     │ 1. Access app        │                                   │                        │
│     │─────────────────────►│                                   │                        │
│     │                      │ 2. Generate AuthnRequest          │                        │
│     │                      │    (SAML Request)                 │                        │
│     │◄─────────────────────│                                   │                        │
│     │ 3. Redirect to IdP   │                                   │                        │
│     │  (with AuthnRequest) │                                   │                        │
│     │─────────────────────────────────────────────────────────►│                        │
│     │                      │                                   │ 4. Authenticate user   │
│     │                      │                                   │    (login page)        │
│     │◄──────────────────────────────────────────────────────────│                        │
│     │ 5. User authenticates│                                   │                        │
│     │─────────────────────────────────────────────────────────►│                        │
│     │                      │                                   │ 6. Generate Assertion  │
│     │◄──────────────────────────────────────────────────────────│    (signed XML)        │
│     │ 7. POST Assertion to │                                   │                        │
│     │    SP ACS URL        │                                   │                        │
│     │─────────────────────►│                                   │                        │
│     │                      │ 8. Validate signature, claims     │                        │
│     │◄─────────────────────│                                   │                        │
│     │ 9. Access granted    │                                   │                        │
└─────────────────────────────────────────────────────────────────────────────────────────┘</pre></div>

          <h2 id="oidc">OIDC Authorization Code Flow (with PKCE)</h2>
          <div class="flow-diagram"><pre>
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                    OIDC AUTHORIZATION CODE + PKCE                                        │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│   USER            CLIENT APP              AUTHORIZATION SERVER         RESOURCE API     │
│     │                 │                          │                         │            │
│     │ 1. Click login  │                          │                         │            │
│     │────────────────►│                          │                         │            │
│     │                 │ 2. Generate PKCE:        │                         │            │
│     │                 │    code_verifier (random)│                         │            │
│     │                 │    code_challenge=SHA256 │                         │            │
│     │                 │                          │                         │            │
│     │◄────────────────│ 3. Redirect to /authorize│                         │            │
│     │                 │    ?response_type=code   │                         │            │
│     │                 │    &client_id=xxx        │                         │            │
│     │                 │    &redirect_uri=xxx     │                         │            │
│     │                 │    &scope=openid profile │                         │            │
│     │                 │    &code_challenge=xxx   │                         │            │
│     │────────────────────────────────────────────►                         │            │
│     │                 │                          │ 4. User authenticates   │            │
│     │◄────────────────────────────────────────────                         │            │
│     │ 5. Redirect back with code                 │                         │            │
│     │────────────────►│                          │                         │            │
│     │                 │ 6. POST /token           │                         │            │
│     │                 │    code=xxx              │                         │            │
│     │                 │    code_verifier=xxx     │                         │            │
│     │                 │───────────────────────────►                         │            │
│     │                 │                          │ 7. Verify PKCE          │            │
│     │                 │◄───────────────────────────                         │            │
│     │                 │ 8. ID Token + Access Token                         │            │
│     │                 │                          │                         │            │
│     │                 │ 9. Call API with Access Token                      │            │
│     │                 │─────────────────────────────────────────────────────►            │
│     │◄────────────────│◄─────────────────────────────────────────────────────            │
│     │ 10. Data        │                          │                         │            │
└─────────────────────────────────────────────────────────────────────────────────────────┘</pre></div>

          <h2 id="kerberos">Kerberos Authentication</h2>
          <div class="flow-diagram"><pre>
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                    KERBEROS AUTHENTICATION                                               │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│   CLIENT              KDC (Domain Controller)              SERVICE                      │
│     │                       │                                  │                        │
│     │ 1. AS-REQ             │                                  │                        │
│     │   (username, timestamp│                                  │                        │
│     │    encrypted with     │                                  │                        │
│     │    password hash)     │                                  │                        │
│     │──────────────────────►│                                  │                        │
│     │                       │ 2. Validate                      │                        │
│     │ 3. AS-REP             │                                  │                        │
│     │   (TGT encrypted with │                                  │                        │
│     │    krbtgt hash)       │                                  │                        │
│     │◄──────────────────────│                                  │                        │
│     │                       │                                  │                        │
│     │ 4. TGS-REQ            │                                  │                        │
│     │   (TGT + SPN request) │                                  │                        │
│     │──────────────────────►│                                  │                        │
│     │                       │ 5. Validate TGT                  │                        │
│     │ 6. TGS-REP            │                                  │                        │
│     │   (Service Ticket)    │                                  │                        │
│     │◄──────────────────────│                                  │                        │
│     │                       │                                  │                        │
│     │ 7. AP-REQ (Service Ticket)                               │                        │
│     │─────────────────────────────────────────────────────────►│                        │
│     │                       │                                  │ 8. Decrypt & validate │
│     │◄─────────────────────────────────────────────────────────│ 9. Access granted     │
└─────────────────────────────────────────────────────────────────────────────────────────┘</pre></div>

          <h2 id="oauth">OAuth 2.0 Client Credentials</h2>
          <div class="flow-diagram"><pre>
┌─────────────────────────────────────────────────────────────────────────────────────────┐
│                    OAUTH CLIENT CREDENTIALS (Machine-to-Machine)                         │
├─────────────────────────────────────────────────────────────────────────────────────────┤
│   SERVICE A                    AUTH SERVER                    SERVICE B (API)           │
│     │                              │                              │                     │
│     │ 1. POST /token               │                              │                     │
│     │    grant_type=client_creds   │                              │                     │
│     │    client_id=xxx             │                              │                     │
│     │    client_secret=xxx         │                              │                     │
│     │    scope=api.read            │                              │                     │
│     │─────────────────────────────►│                              │                     │
│     │                              │ 2. Validate credentials      │                     │
│     │ 3. Access Token              │                              │                     │
│     │◄─────────────────────────────│                              │                     │
│     │                              │                              │                     │
│     │ 4. GET /api/data             │                              │                     │
│     │    Authorization: Bearer xxx │                              │                     │
│     │─────────────────────────────────────────────────────────────►                     │
│     │                              │                              │ 5. Validate token  │
│     │◄─────────────────────────────────────────────────────────────                     │
│     │ 6. Response                  │                              │                     │
└─────────────────────────────────────────────────────────────────────────────────────────┘</pre></div>

          <nav class="page-nav">
            <a href="12-3-scenario-questions.html" class="page-nav-link prev"><span class="page-nav-label">← Previous</span><span class="page-nav-title">Scenario Questions</span></a>
            <a href="12-5-comparison-tables.html" class="page-nav-link next"><span class="page-nav-label">Next →</span><span class="page-nav-title">Comparison Tables</span></a>
          </nav>
        </article>
      </div>
    </main>
  </div>
  <script src="main.js"></script>
</body>
</html>
