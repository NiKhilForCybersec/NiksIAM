<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenID Connect - Ultimate IAM Security Guide</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <div class="page-wrapper">
    <button class="mobile-menu-toggle" aria-label="Toggle navigation">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    <nav class="sidebar">
      <div class="sidebar-header">
        <a href="index.html" class="sidebar-logo">
          <div class="sidebar-logo-icon">ğŸ”</div>
          <div class="sidebar-logo-text">IAM <span>Guide</span></div>
        </a>
      </div>
    </nav>
    <main class="main-content">
      <div class="content-wrapper">
        <article class="content-main">
          <div class="badge badge-l2">L2 Technical</div>
          <h1>OpenID Connect (OIDC)</h1>
          
          <div class="overview-box">
            <h3>ğŸ¯ What You'll Learn</h3>
            <p>OIDC = OAuth 2.0 + Identity. It's the modern protocol behind "Sign in with Google/Microsoft/Apple." This page shows you how OIDC adds authentication on top of OAuth.</p>
          </div>

          <!-- THE KEY DIFFERENCE -->
          <h2 id="key-concept">ğŸ”‘ The Key Relationship</h2>
          <div class="callout tip"><div class="callout-content"><div class="callout-title">OIDC = OAuth 2.0 + ID Token</div>
            
            <div class="flow-diagram"><pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OAUTH vs OIDC                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚                           OIDC (OpenID Connect)                               â”‚     â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚     â”‚
â”‚   â”‚  â”‚                         OAuth 2.0                                       â”‚  â”‚     â”‚
â”‚   â”‚  â”‚                                                                         â”‚  â”‚     â”‚
â”‚   â”‚  â”‚   Access Token = "You can access this API"                             â”‚  â”‚     â”‚
â”‚   â”‚  â”‚   (Authorization)                                                       â”‚  â”‚     â”‚
â”‚   â”‚  â”‚                                                                         â”‚  â”‚     â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚     â”‚
â”‚   â”‚                                                                               â”‚     â”‚
â”‚   â”‚   + ID Token = "Here's who the user is"                                      â”‚     â”‚
â”‚   â”‚     (Authentication)                                                          â”‚     â”‚
â”‚   â”‚                                                                               â”‚     â”‚
â”‚   â”‚   + UserInfo Endpoint = "Get more details about the user"                    â”‚     â”‚
â”‚   â”‚                                                                               â”‚     â”‚
â”‚   â”‚   + Standard Scopes = openid, profile, email, etc.                           â”‚     â”‚
â”‚   â”‚                                                                               â”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                                          â”‚
â”‚   SIMPLE VERSION:                                                                       â”‚
â”‚   OAuth = "What can I do?" (authorization)                                              â”‚
â”‚   OIDC  = "Who am I?" + "What can I do?" (authentication + authorization)             â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</pre></div>
          </div></div>

          <!-- MEMORY TRICKS -->
          <h2 id="memory-tricks">ğŸ§  Memory Tricks</h2>
          <div class="callout warning"><div class="callout-content"><div class="callout-title">ğŸ’¡ Remember These Forever</div>
            
            <p><strong>ğŸ« "ID Token = Passport"</strong></p>
            <p>The ID Token is like a passport - it contains verified information about WHO you are. Name, email, when you authenticated - all stamped and signed by the Identity Provider.</p>

            <p style="margin-top:1rem;"><strong>ğŸŸï¸ "Access Token = Ticket"</strong></p>
            <p>The Access Token is your ticket to access services (APIs). The ID Token proves who you are, the Access Token lets you in.</p>

            <p style="margin-top:1rem;"><strong>ğŸ“‹ "ID Token for the APP, Access Token for the API"</strong></p>
            <p>The app reads the ID Token to know who logged in. The Access Token goes to APIs. NEVER send the ID Token to APIs!</p>

            <p style="margin-top:1rem;"><strong>ğŸ”‘ The Magic Scope: "openid"</strong></p>
            <p>To get an ID Token, you MUST include the <code>openid</code> scope in your request. No openid scope = no ID Token = just OAuth (not OIDC).</p>
          </div></div>

          <!-- ID TOKEN EXPLAINED -->
          <h2 id="id-token">ğŸªª The ID Token Explained</h2>
          <div class="code-block"><div class="code-header"><span class="code-language">What's Inside an ID Token</span></div><pre><code># ID TOKEN IS A JWT (JSON Web Token)
# Three parts separated by dots: HEADER.PAYLOAD.SIGNATURE

eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.
eyJpc3MiOiJodHRwczovL2xvZ2luLm1pY3Jvc29mdG9ubGluZS5jb20vMTIzNDU2Nzg5IiwiYXVkIjoibXktYXBwLWlkIiwic3ViIjoiYWJjZGVmZyIsImVtYWlsIjoiam9obkBjb21wYW55LmNvbSIsIm5hbWUiOiJKb2huIFNtaXRoIiwiaWF0IjoxNzA0MDY3MjAwLCJleHAiOjE3MDQwNzA4MDB9.
SIGNATURE_HERE

# DECODED PAYLOAD:
{
  "iss": "https://login.microsoftonline.com/12345",  â† ISSUER: Who issued this token
  "aud": "my-app-id",                                 â† AUDIENCE: Who is this for
  "sub": "abcdefg",                                   â† SUBJECT: Unique user ID
  "email": "john@company.com",                        â† User's email
  "name": "John Smith",                               â† User's display name
  "iat": 1704067200,                                  â† ISSUED AT: When token was created
  "exp": 1704070800,                                  â† EXPIRES: When token becomes invalid
  "nonce": "random123"                                â† Replay prevention
}

# WHAT YOUR APP SHOULD CHECK:
âœ“ Signature is valid (using IdP's public key)
âœ“ "iss" matches expected issuer
âœ“ "aud" matches your app's client ID  
âœ“ "exp" is in the future (not expired)
âœ“ "nonce" matches what you sent (if you sent one)</code></pre></div>

          <!-- STANDARD SCOPES -->
          <h2 id="scopes">ğŸ“‹ Standard OIDC Scopes</h2>
          <div class="table-wrapper"><table>
            <thead><tr><th>Scope</th><th>What You Get</th><th>Example Claims</th></tr></thead>
            <tbody>
              <tr><td><strong>openid</strong></td><td>REQUIRED for OIDC</td><td>sub (subject/user ID)</td></tr>
              <tr><td><strong>profile</strong></td><td>Basic profile info</td><td>name, family_name, given_name, picture</td></tr>
              <tr><td><strong>email</strong></td><td>Email address</td><td>email, email_verified</td></tr>
              <tr><td><strong>address</strong></td><td>Physical address</td><td>address (formatted object)</td></tr>
              <tr><td><strong>phone</strong></td><td>Phone number</td><td>phone_number, phone_number_verified</td></tr>
              <tr><td><strong>offline_access</strong></td><td>Refresh token</td><td>(Gets you a refresh token)</td></tr>
            </tbody>
          </table></div>

          <div class="code-block"><div class="code-header"><span class="code-language">Scope Examples</span></div><pre><code># MINIMAL LOGIN (just get user ID)
scope=openid

# TYPICAL LOGIN (ID + profile info)
scope=openid profile email

# WITH REFRESH TOKEN
scope=openid profile email offline_access

# WITH CUSTOM API ACCESS
scope=openid profile email api://my-api/read</code></pre></div>

          <!-- THE FLOW -->
          <h2 id="flow">ğŸ“ OIDC Flow in Plain English</h2>
          <div class="callout info"><div class="callout-content"><div class="callout-title">ğŸš¶ "Sign in with Microsoft" Step by Step</div>
            
            <p><strong>Step 1: User clicks "Sign in with Microsoft"</strong></p>
            <p>Your app redirects to Microsoft's authorization endpoint with:</p>
            <ul>
              <li>client_id (your app's ID)</li>
              <li>scope=openid profile email (what info you want)</li>
              <li>response_type=code (using auth code flow)</li>
              <li>redirect_uri (where to come back)</li>
            </ul>
            
            <p style="margin-top:1rem;"><strong>Step 2: User authenticates at Microsoft</strong></p>
            <p>Microsoft's login page â†’ user enters credentials â†’ MFA if required</p>
            
            <p style="margin-top:1rem;"><strong>Step 3: Consent (first time only)</strong></p>
            <p>"This app wants to see your name and email. Allow?"</p>
            
            <p style="margin-top:1rem;"><strong>Step 4: Redirect back with code</strong></p>
            <p>Microsoft redirects to your app with an authorization code</p>
            
            <p style="margin-top:1rem;"><strong>Step 5: Exchange code for tokens</strong></p>
            <p>Your backend exchanges the code for:</p>
            <ul>
              <li><strong>ID Token</strong> - Who is this user?</li>
              <li><strong>Access Token</strong> - To call APIs</li>
              <li><strong>Refresh Token</strong> - To get new tokens (if offline_access scope)</li>
            </ul>
            
            <p style="margin-top:1rem;"><strong>Step 6: App reads ID Token</strong></p>
            <p>Your app decodes the ID Token to get user info:</p>
            <p>"Welcome, John Smith (john@company.com)!"</p>
          </div></div>

          <!-- ENDPOINTS -->
          <h2 id="discovery">ğŸ” Discovery Document</h2>
          <div class="code-block"><div class="code-header"><span class="code-language">OIDC Discovery</span></div><pre><code># Every OIDC provider has a discovery document at:
/.well-known/openid-configuration

# EXAMPLE: Microsoft
GET https://login.microsoftonline.com/{tenant}/v2.0/.well-known/openid-configuration

# RETURNS:
{
  "issuer": "https://login.microsoftonline.com/{tenant}/v2.0",
  "authorization_endpoint": "https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize",
  "token_endpoint": "https://login.microsoftonline.com/{tenant}/oauth2/v2.0/token",
  "userinfo_endpoint": "https://graph.microsoft.com/oidc/userinfo",
  "jwks_uri": "https://login.microsoftonline.com/{tenant}/discovery/v2.0/keys",
  "scopes_supported": ["openid", "profile", "email", "offline_access"],
  "response_types_supported": ["code", "id_token", "token"],
  ...
}

# WHY THIS MATTERS:
- Automatic configuration! No hardcoding endpoints
- jwks_uri = Where to get public keys to verify token signatures
- Libraries use this to auto-configure</code></pre></div>

          <!-- COMMON MISTAKES -->
          <h2 id="mistakes">ğŸš« Common OIDC Mistakes</h2>
          <div class="callout critical"><div class="callout-content"><div class="callout-title">Don't Do These!</div>
            <ul>
              <li>âŒ <strong>Sending ID Token to APIs</strong> - ID Token is for YOUR app only. Send Access Token to APIs!</li>
              <li>âŒ <strong>Not validating ID Token</strong> - Always check signature, issuer, audience, expiry</li>
              <li>âŒ <strong>Trusting claims without validation</strong> - Anyone can create a JWT, you must verify the signature</li>
              <li>âŒ <strong>Forgetting the "openid" scope</strong> - No openid = no ID Token = just OAuth, not OIDC</li>
              <li>âŒ <strong>Storing tokens in localStorage</strong> - Use httpOnly cookies or secure memory</li>
            </ul>
          </div></div>

          <!-- VS SAML -->
          <h2 id="vs-saml">âš”ï¸ OIDC vs SAML</h2>
          <div class="table-wrapper"><table>
            <thead><tr><th>Aspect</th><th>OIDC</th><th>SAML</th></tr></thead>
            <tbody>
              <tr><td><strong>Format</strong></td><td>JSON (JWT)</td><td>XML</td></tr>
              <tr><td><strong>Designed For</strong></td><td>Modern apps, mobile, APIs</td><td>Enterprise web SSO</td></tr>
              <tr><td><strong>Token Size</strong></td><td>Smaller</td><td>Larger (XML verbose)</td></tr>
              <tr><td><strong>Mobile Friendly</strong></td><td>Yes</td><td>Not really</td></tr>
              <tr><td><strong>Developer Experience</strong></td><td>Easier</td><td>More complex</td></tr>
              <tr><td><strong>Enterprise Adoption</strong></td><td>Growing rapidly</td><td>Dominant (legacy)</td></tr>
            </tbody>
          </table></div>

          <!-- INTERVIEW TIPS -->
          <h2 id="interview-tips">Interview Tips</h2>
          <div class="callout interview"><div class="callout-content"><div class="callout-title">ğŸ’¡ How to Nail OIDC Questions</div>
            
            <p><strong>If asked "What is OIDC?":</strong></p>
            <p>"OpenID Connect is an identity layer built on top of OAuth 2.0. While OAuth handles authorization - what resources you can access - OIDC adds authentication - proving who you are. It does this by adding an ID Token, which is a JWT containing user identity claims, signed by the Identity Provider."</p>

            <p style="margin-top:1rem;"><strong>If asked "What's the ID Token?":</strong></p>
            <p>"The ID Token is a JWT that contains claims about the user - their unique ID, name, email, when they authenticated. It's signed by the Identity Provider so the app can verify it's authentic. The app reads the ID Token to know who logged in, but never sends it to APIs - that's what the Access Token is for."</p>

            <p style="margin-top:1rem;"><strong>If asked "How do you validate an ID Token?":</strong></p>
            <p>"First, verify the signature using the IdP's public keys from the JWKS endpoint. Then check that the issuer matches the expected IdP, the audience matches your client ID, and the token hasn't expired. If you sent a nonce, verify that matches too."</p>
          </div></div>

          <h2 id="quick-reference">âš¡ Quick Reference Card</h2>
          <div class="code-block"><div class="code-header"><span class="code-language">OIDC Cheat Sheet</span></div><pre><code>OIDC = OAuth 2.0 + ID Token (Authentication layer)

TOKENS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ID Token = WHO you are (for your app)
Access Token = WHAT you can access (for APIs)
Refresh Token = Get new tokens

REQUIRED SCOPE: openid
COMMON SCOPES: openid profile email offline_access

ID TOKEN VALIDATION:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ“ Verify signature (JWKS)
âœ“ Check issuer (iss)
âœ“ Check audience (aud) 
âœ“ Check expiry (exp)
âœ“ Check nonce (if used)

DISCOVERY ENDPOINT:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/.well-known/openid-configuration

KEY CLAIMS IN ID TOKEN:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
sub = Subject (unique user ID)
iss = Issuer
aud = Audience (your app)
exp = Expiration time
iat = Issued at
name, email, etc. = User info</code></pre></div>

          <nav class="page-nav">
            <a href="2-5-oauth2.html" class="page-nav-link prev"><span class="page-nav-label">â† Previous</span><span class="page-nav-title">OAuth 2.0</span></a>
            <a href="2-7-radius-tacacs.html" class="page-nav-link next"><span class="page-nav-label">Next â†’</span><span class="page-nav-title">RADIUS & TACACS+</span></a>
          </nav>
        </article>
      </div>
    </main>
  </div>
  <script src="main.js"></script>
</body>
</html>
