<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenID Connect - Ultimate IAM Security Guide</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <div class="page-wrapper">
    <!-- Mobile Menu Toggle -->
    <button class="mobile-menu-toggle" aria-label="Toggle navigation">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    <nav class="sidebar">
      <div class="sidebar-header">
        <a href="index.html" class="sidebar-logo">
          <div class="sidebar-logo-icon">ğŸ”</div>
          <div class="sidebar-logo-text">IAM <span>Guide</span></div>
        </a>
      </div>
    </nav>
    <main class="main-content">
      <div class="content-wrapper">
        <article class="content-main">
          <div class="badge badge-l2">L2 Technical</div>
          <h1>OpenID Connect (OIDC)</h1>
          
          <div class="overview-box">
            <h3>ğŸ¯ What This Page Covers</h3>
            <p>OIDC adds identity (authentication) on top of OAuth 2.0 (authorization). This covers the ID token, flows, claims, and how OIDC is used for SSO in modern applications.</p>
          </div>

          <h2 id="oidc-vs-oauth">OIDC vs OAuth 2.0</h2>

          <div class="flow-diagram">
            <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OIDC = OAuth 2.0 + Identity Layer                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                           OPENID CONNECT                                        â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚   â”‚  ID Token (JWT) - WHO the user is                                       â”‚   â”‚   â”‚
â”‚   â”‚   â”‚  UserInfo Endpoint - Additional user claims                             â”‚   â”‚   â”‚
â”‚   â”‚   â”‚  Standard Scopes (openid, profile, email)                               â”‚   â”‚   â”‚
â”‚   â”‚   â”‚  Discovery Document (/.well-known/openid-configuration)                 â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â”‚                                                                                 â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚   â”‚   â”‚                         OAUTH 2.0                                       â”‚   â”‚   â”‚
â”‚   â”‚   â”‚  Access Token - WHAT the user can access                                â”‚   â”‚   â”‚
â”‚   â”‚   â”‚  Refresh Token - Get new access tokens                                  â”‚   â”‚   â”‚
â”‚   â”‚   â”‚  Authorization Flows - How to get tokens                                â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                          â”‚
â”‚   KEY DIFFERENCE:                                                                       â”‚
â”‚   â€¢ OAuth 2.0: "App X can access your calendar" (Authorization)                        â”‚
â”‚   â€¢ OIDC: "You are john@example.com" (Authentication)                                   â”‚
â”‚                                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </pre>
          </div>

          <h2 id="id-token">The ID Token</h2>
          <p>The ID Token is a JWT (JSON Web Token) that contains claims about the authenticated user.</p>

          <div class="code-block">
            <div class="code-header"><span class="code-language">ID Token Structure (Decoded JWT)</span></div>
            <pre><code>// HEADER
{
  "typ": "JWT",
  "alg": "RS256",
  "kid": "abc123"  // Key ID for signature verification
}

// PAYLOAD (Claims)
{
  // Required Claims
  "iss": "https://login.microsoftonline.com/tenant-id/v2.0",  // Issuer
  "sub": "AaBbCcDdEeFf...",                                    // Subject (unique user ID)
  "aud": "client-id-12345",                                    // Audience (your app)
  "exp": 1704067200,                                           // Expiration (Unix timestamp)
  "iat": 1704063600,                                           // Issued At
  "nonce": "random-nonce-value",                               // Replay protection
  
  // Common Optional Claims
  "name": "Sarah Chen",
  "preferred_username": "schen@company.com",
  "email": "sarah.chen@company.com",
  "email_verified": true,
  "given_name": "Sarah",
  "family_name": "Chen",
  "picture": "https://graph.microsoft.com/v1.0/me/photo",
  
  // Entra ID Specific
  "tid": "tenant-id",        // Tenant ID
  "oid": "object-id",        // Object ID in directory
  "groups": ["group1-id", "group2-id"]
}

// SIGNATURE
// RS256 signature verified with IdP's public key (from JWKS endpoint)</code></pre>
          </div>

          <h2 id="flows">OIDC Flows</h2>

          <div class="table-wrapper">
            <table>
              <thead><tr><th>Flow</th><th>Returns</th><th>Use Case</th><th>Security</th></tr></thead>
              <tbody>
                <tr>
                  <td><strong>Authorization Code + PKCE</strong></td>
                  <td>Code â†’ ID Token + Access Token</td>
                  <td>Web apps, SPAs, mobile</td>
                  <td>âœ… Recommended</td>
                </tr>
                <tr>
                  <td><strong>Implicit (DEPRECATED)</strong></td>
                  <td>ID Token directly in URL</td>
                  <td>Legacy SPAs</td>
                  <td>âŒ Avoid</td>
                </tr>
                <tr>
                  <td><strong>Hybrid</strong></td>
                  <td>Code + ID Token, then Access Token</td>
                  <td>Server-side apps needing immediate ID</td>
                  <td>ğŸŸ¡ Complex</td>
                </tr>
              </tbody>
            </table>
          </div>

          <h2 id="scopes">Standard OIDC Scopes</h2>

          <div class="code-block">
            <div class="code-header"><span class="code-language">OIDC Scopes</span></div>
            <pre><code># Required
openid          # Indicates OIDC request, returns sub claim

# Optional Standard Scopes
profile         # name, family_name, given_name, picture, etc.
email           # email, email_verified
address         # formatted address
phone           # phone_number, phone_number_verified

# Request Example
scope=openid profile email

# This returns an ID token with:
{
  "sub": "user-id",
  "name": "Sarah Chen",
  "email": "sarah.chen@company.com",
  "email_verified": true
}</code></pre>
          </div>

          <h2 id="discovery">Discovery Document</h2>
          <p>OIDC providers publish a discovery document with all endpoints and configuration.</p>

          <div class="code-block">
            <div class="code-header"><span class="code-language">Discovery Document Example</span></div>
            <pre><code># URL: https://login.microsoftonline.com/{tenant}/v2.0/.well-known/openid-configuration

{
  "issuer": "https://login.microsoftonline.com/{tenant}/v2.0",
  "authorization_endpoint": "https://login.microsoftonline.com/{tenant}/oauth2/v2.0/authorize",
  "token_endpoint": "https://login.microsoftonline.com/{tenant}/oauth2/v2.0/token",
  "userinfo_endpoint": "https://graph.microsoft.com/oidc/userinfo",
  "jwks_uri": "https://login.microsoftonline.com/{tenant}/discovery/v2.0/keys",
  "end_session_endpoint": "https://login.microsoftonline.com/{tenant}/oauth2/v2.0/logout",
  
  "scopes_supported": ["openid", "profile", "email", "offline_access"],
  "response_types_supported": ["code", "id_token", "token"],
  "subject_types_supported": ["pairwise"],
  "id_token_signing_alg_values_supported": ["RS256"],
  "claims_supported": ["sub", "name", "email", "preferred_username", ...]
}</code></pre>
          </div>

          <h2 id="validation">ID Token Validation</h2>

          <div class="code-block">
            <div class="code-header"><span class="code-language">Token Validation Checklist</span></div>
            <pre><code># Your app MUST validate these before trusting the ID token:

1. SIGNATURE
   âœ“ Fetch public keys from jwks_uri
   âœ“ Verify signature matches using correct key (kid)
   
2. ISSUER (iss)
   âœ“ Must match expected issuer exactly
   âœ“ "https://login.microsoftonline.com/{tenant}/v2.0"

3. AUDIENCE (aud)
   âœ“ Must contain YOUR client_id
   âœ“ Reject tokens meant for other apps

4. EXPIRATION (exp)
   âœ“ Current time must be before exp
   âœ“ Token expired = reject

5. ISSUED AT (iat)
   âœ“ Should be reasonable (not in distant past/future)

6. NONCE
   âœ“ Must match nonce you sent in auth request
   âœ“ Prevents replay attacks

# Example validation (pseudo-code)
if (token.iss !== expectedIssuer) throw "Invalid issuer";
if (!token.aud.includes(myClientId)) throw "Invalid audience";
if (Date.now() > token.exp * 1000) throw "Token expired";
if (token.nonce !== sessionNonce) throw "Invalid nonce";</code></pre>
          </div>

          <h2 id="interview-tips">Interview Tips</h2>
          <div class="callout interview">
            <div class="callout-content">
              <div class="callout-title">ğŸ’¡ Key Interview Points</div>
              <ul>
                <li><strong>OIDC vs OAuth:</strong> OIDC = Authentication (who), OAuth = Authorization (what access)</li>
                <li><strong>ID Token:</strong> JWT with user claims, NOT for API access</li>
                <li><strong>Access Token:</strong> For API access, may or may not be JWT</li>
                <li><strong>Required scope:</strong> "openid" must be included for OIDC</li>
                <li><strong>Validation:</strong> Always verify issuer, audience, expiration, signature</li>
                <li><strong>Discovery:</strong> /.well-known/openid-configuration has all endpoints</li>
              </ul>
            </div>
          </div>

          <nav class="page-nav">
            <a href="2-5-oauth2.html" class="page-nav-link prev">
              <span class="page-nav-label">â† Previous</span>
              <span class="page-nav-title">OAuth 2.0</span>
            </a>
            <a href="2-7-radius-tacacs.html" class="page-nav-link next">
              <span class="page-nav-label">Next â†’</span>
              <span class="page-nav-title">RADIUS & TACACS+</span>
            </a>
          </nav>
        </article>
      </div>
    </main>
  </div>
  <script src="main.js"></script>
</body>
</html>
